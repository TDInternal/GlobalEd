<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terra Dotta: Solution Finder</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Custom Tailwind Config for Brand Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'td-blue': '#00aeef',
                        'td-green': '#8dc73f',
                        'td-orange': '#f57922',
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Apply the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa; /* Light gray background for contrast */
        }
        
        /* Transition for showing/hiding steps */
        .wizard-step {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            will-change: opacity, transform;
        }

        .wizard-step.hidden {
            opacity: 0;
            transform: translateY(20px);
            position: absolute;
            pointer-events: none;
        }

        /* Custom Radio/Checkbox Styling */
        .custom-checkbox:checked, .custom-radio:checked {
            background-color: #00aeef;
            border-color: #00aeef;
        }
        .custom-checkbox:checked + label, .custom-radio:checked + label {
            color: #00aeef;
            font-weight: 600;
        }
        label {
            transition: color 0.2s;
        }

        .card-hover {
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.08), 0 4px 6px -4px rgb(0 0 0 / 0.08);
        }
        
        /* Custom list style for benefits */
        .benefits-list li {
            position: relative;
            padding-left: 28px; /* Space for the icon */
            margin-bottom: 8px;
        }
        .benefits-list li::before {
            content: '✔';
            position: absolute;
            left: 0;
            top: 1px;
            color: #8dc73f; /* td-green */
            font-weight: bold;
            font-size: 18px;
        }

        /* Notification animations */
        .notification {
            animation: slideInFromRight 0.5s ease-out;
        }
        
        .notification.removing {
            animation: slideOutToRight 0.3s ease-in forwards;
        }

        @keyframes slideInFromRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutToRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Progress indicator */
        .progress-step {
            transition: all 0.3s ease;
        }

        .progress-step.completed {
            background-color: #8dc73f;
            color: white;
        }

        .progress-step.current {
            background-color: #00aeef;
            color: white;
        }

        /* Print-specific styles */
        @media print {
            /* Hide elements that are not part of the results page */
            body > header, .wizard-step:not(#step6), #results-actions, #results-back-button, #notification-container, #progress-indicator, #admin-panel {
                display: none !important;
            }
            
            /* Ensure the results step is visible and takes up the full space */
            main, #solutionFinder, #step6 {
                display: block !important;
                visibility: visible !important;
                position: static !important;
                box-shadow: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 0 !important;
                min-height: auto !important;
            }
            
            #solutionFinder {
                padding: 1rem !important; /* Add some padding back for content spacing */
            }

            /* Improve page break behavior to keep content blocks together */
            #value-proposition-container, #barrier-responses-container, #barrier-responses > div, .grid > div {
                break-inside: avoid;
            }
            
            /* General print typography for better readability */
            body {
                background-color: #fff !important;
            }
            
            h1, h2, h3, h4, p, li, label, a {
                color: #000 !important;
            }
            
            .bg-blue-50 {
                background-color: #f0f9ff !important;
                border-color: #00aeef !important;
            }

            .text-td-blue { color: #00aeef !important; }
            .text-td-green { color: #8dc73f !important; }

            /* Ensure SVG icons print and links are styled for print */
            svg { stroke: currentColor !important; }
            a { text-decoration: none; }
        }
    </style>
</head>
<body class="text-slate-700">
    
    <!-- Notification Container -->
    <div id="notification-container" class="fixed top-4 right-4 z-50 space-y-2 w-full max-w-sm"></div>

    <!-- Header Banner -->
    <header class="bg-td-blue text-white text-center py-12 sm:py-16">
        <div class="max-w-5xl mx-auto px-4">
            <p class="text-xl font-semibold text-blue-200 mb-2">Terra Dotta</p>
            <h1 class="text-4xl sm:text-5xl font-extrabold mb-4">Find Your Solution</h1>
            <p class="text-lg sm:text-xl text-blue-100 max-w-3xl mx-auto">
                Answer a few questions about your institution's needs, and we'll recommend the right solutions to help you build a more connected campus.
            </p>
        </div>
    </header>

    <main class="max-w-5xl mx-auto p-4 sm:p-8 -mt-20">
        
        <!-- Progress Indicator -->
        <div id="progress-indicator" class="bg-white p-3 rounded-t-2xl shadow-lg mb-0 border-b border-slate-200">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <div class="progress-step current w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-sm font-semibold">1</div>
                    <div class="flex-1 h-1 bg-slate-200 rounded-full"><div class="progress-bar w-0 bg-td-blue h-1 rounded-full"></div></div>
                    <div class="progress-step w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-sm font-semibold">2</div>
                     <div class="flex-1 h-1 bg-slate-200 rounded-full"><div class="progress-bar w-0 bg-td-blue h-1 rounded-full"></div></div>
                    <div class="progress-step w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-sm font-semibold">3</div>
                     <div class="flex-1 h-1 bg-slate-200 rounded-full"><div class="progress-bar w-0 bg-td-blue h-1 rounded-full"></div></div>
                    <div class="progress-step w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-sm font-semibold">4</div>
                     <div class="flex-1 h-1 bg-slate-200 rounded-full"><div class="progress-bar w-0 bg-td-blue h-1 rounded-full"></div></div>
                    <div class="progress-step w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-sm font-semibold">5</div>
                     <div class="flex-1 h-1 bg-slate-200 rounded-full"><div class="progress-bar w-0 bg-td-blue h-1 rounded-full"></div></div>
                    <div class="progress-step w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-sm font-semibold">6</div>
                </div>
            </div>
        </div>

        <div id="solutionFinder" class="bg-white p-6 sm:p-10 rounded-b-2xl shadow-lg relative min-h-[550px]">
            
            <!-- Step 1: Location -->
            <div id="step1" class="wizard-step">
                <h2 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">Step 1: Where are you located?</h2>
                <p class="text-slate-500 mb-8">Please select your location to begin.</p>
                <div class="space-y-4">
                    <div class="flex items-start">
                        <input id="location-us" name="location" type="radio" value="us" class="custom-radio h-5 w-5 rounded-full border-gray-300 text-td-blue focus:ring-td-blue flex-shrink-0 mt-1">
                        <label for="location-us" class="ml-3 text-md text-slate-600">Within a US State</label>
                    </div>
                    <div id="state-dropdown-container" class="ml-8 mt-2 hidden">
                         <select id="state-dropdown" class="w-full max-w-xs p-2 border border-gray-300 rounded-lg focus:ring-td-blue focus:border-td-blue">
                            <option value="">Select your state...</option>
                        </select>
                    </div>
                    <div class="flex items-start">
                        <input id="location-intl" name="location" type="radio" value="intl" class="custom-radio h-5 w-5 rounded-full border-gray-300 text-td-blue focus:ring-td-blue flex-shrink-0 mt-1">
                        <label for="location-intl" class="ml-3 text-md text-slate-600">Outside the US</label>
                    </div>
                </div>
                <div class="text-right">
                     <div id="location-error" class="text-red-500 text-sm mt-4 hidden">Please select a location and state to continue.</div>
                    <div class="mt-4">
                        <button id="next-btn-1" class="bg-td-blue hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-all">Next &rarr;</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Role Selection -->
            <div id="step2" class="wizard-step hidden">
                <h2 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">Step 2: Your Role</h2>
                <p class="text-slate-500 mb-8">Please select the role that best describes your position.</p>
                <div id="roles" class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4"></div>
                <div class="mt-10 flex justify-between">
                     <button id="back-btn-2" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-3 px-8 rounded-lg transition-all">&larr; Back</button>
                    <div class="text-right">
                        <div id="role-error" class="text-red-500 text-sm mb-2 hidden">Please select a role to continue.</div>
                        <button id="next-btn-2" class="bg-td-blue hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-all">Next &rarr;</button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Current Solutions -->
            <div id="step3" class="wizard-step hidden">
                <h2 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">Step 3: What You Have</h2>
                <p class="text-slate-500 mb-8">Select the Terra Dotta solutions your campus or office currently uses. Or, let us know if you're new to Terra Dotta.</p>
                <div class="flex space-x-4 mb-6">
                    <button id="no-solutions-btn" class="flex-1 text-center bg-td-orange hover:bg-orange-500 text-white font-bold py-2 px-4 rounded-lg transition-all shadow-sm">
                        I'm new to Terra Dotta
                    </button>
                    <button id="competitor-btn" class="flex-1 text-center bg-slate-500 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg transition-all shadow-sm">
                        I use another vendor
                    </button>
                </div>
                <div id="currentSolutions" class="space-y-4 pt-6 border-t border-slate-200"></div>
                <div class="mt-10 flex justify-between">
                    <button id="back-btn-3" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-3 px-8 rounded-lg transition-all">&larr; Back</button>
                    <button id="next-btn-3" class="bg-td-blue hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-all">Next &rarr;</button>
                </div>
            </div>

            <!-- Step 4: Your Challenges -->
            <div id="step4" class="wizard-step hidden">
                <h2 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">Step 4: Your Challenges</h2>
                <p id="challenges-prompt" class="text-slate-500 mb-8">Based on your role, what are your biggest challenges right now? Select all that apply.</p>
                <div id="challenges" class="space-y-4"></div>
                <div class="mt-10 flex justify-between">
                    <button id="back-btn-4" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-3 px-8 rounded-lg transition-all">&larr; Back</button>
                    <button id="next-btn-4" class="bg-td-blue hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-all">Next &rarr;</button>
                </div>
            </div>
            
            <!-- Step 5: Barriers -->
            <div id="step5" class="wizard-step hidden">
                <h2 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">Step 5: Potential Barriers</h2>
                <p class="text-slate-500 mb-8">What are your biggest concerns about adopting new software?</p>
                <div id="barriers" class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4"></div>
                <div class="mt-10 flex justify-between">
                    <button id="back-btn-5" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-3 px-8 rounded-lg transition-all">&larr; Back</button>
                    <button id="results-btn" class="bg-td-green hover:bg-green-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-all">See My Recommendations</button>
                </div>
            </div>

            <!-- Step 6: Results -->
            <div id="step6" class="wizard-step hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-6 text-center">Your Connected Campus Journey</h2>
                <div id="value-proposition-container" class="bg-blue-50 border-l-4 border-td-blue text-slate-700 p-4 rounded-r-lg mb-8"><h3 class="font-bold text-td-blue">Value Proposition for Your Role</h3><p id="value-proposition-text" class="mt-1 text-sm"></p></div>
                <div id="advantage-container" class="mb-8 hidden"><h3 class="font-bold text-2xl text-slate-800 mb-6 text-center">The Terra Dotta Advantage</h3><div id="advantage-responses" class="space-y-6"></div></div>
                <div id="barrier-responses-container" class="mb-8 hidden"><h3 class="font-bold text-2xl text-slate-800 mb-6 text-center">Addressing Your Concerns</h3><div id="barrier-responses" class="space-y-6"></div></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12"><div><h3 class="font-bold text-xl text-slate-700 mb-4 text-center">Your Current Ecosystem</h3><div id="currentResults" class="space-y-4"></div></div><div><h3 class="font-bold text-xl text-td-green mb-4 text-center">Your Recommended Additions</h3><div id="recommendedResults" class="space-y-4"></div></div></div>
                <hr class="my-10 border-slate-200">
                <div><h3 class="font-bold text-2xl text-slate-800 mb-6 text-center">Now your campus or your office will be able to...</h3><ul id="benefits" class="benefits-list text-slate-600 max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-2"></ul></div>
                <div id="results-actions" class="mt-12 text-center space-y-4">
                    <h3 class="text-2xl font-bold text-slate-800">Share Your Results & Next Steps</h3>
                    <div class="flex flex-wrap justify-center items-center gap-4 pt-4">
                        <a href="https://www.terradotta.com/request-demo.html" target="_blank" class="w-full sm:w-auto inline-block bg-td-green hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">Ready to Schedule a Demo?</a>
                        <button id="connect-director-btn" class="w-full sm:w-auto bg-td-blue hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-all hidden">Connect with your Local Director</button>
                        <button id="email-btn" class="w-full sm:w-auto bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 px-6 rounded-lg transition-all">Email Results to Myself</button>
                        <button id="print-btn" class="w-full sm:w-auto bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 px-6 rounded-lg transition-all">Print</button>
                        <button id="reset-btn" class="w-full sm:w-auto bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-3 px-6 rounded-lg transition-all">Start Over</button>
                    </div>
                </div>
                <div id="results-back-button" class="mt-8 flex">
                    <button id="back-btn-6" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-3 px-8 rounded-lg transition-all">&larr; Back</button>
                </div>
            </div>

        </div>
    </main>
    
    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center max-w-sm mx-4">
            <h3 class="text-xl font-bold text-slate-800 mb-4">Are you sure?</h3>
            <p class="text-slate-600 mb-6">This will clear all your selections and restart the tool.</p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-reset-btn" class="bg-td-orange hover:bg-orange-600 text-white font-bold py-2 px-6 rounded-lg">Yes, Start Over</button>
                <button id="cancel-reset-btn" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg">Cancel</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
    
        // --- DATA OBJECTS ---
        const solutions = { 
            'Study Abroad': { name: 'Study Abroad Platform', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9V3m0 18a9 9 0 009-9M3 12a9 9 0 019-9m0 18a9 9 0 00-9-9m9 9H3" />', description: 'Your current system enhances the applicant experience with a searchable program catalog and seamless online applications.', solves: 'Streamline the entire outbound mobility lifecycle into one manageable hub.', color: 'text-td-blue', url: 'https://www.terradotta.com/study-abroad.html', category: 'application_program_management', categoryTitle: 'Application & Program Management' }, 
            'ISSS': { name: 'ISSS (International Student & Scholar Services)', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656-.126-1.283-.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" />', description: 'Centralize academic records, biographic data, and SEVIS compliance management to streamline visa processes and maintain regulatory standards.', solves: 'Reduce administrative burden and SEVIS risk to improve international student yield.', color: 'text-td-blue', url: 'https://www.terradotta.com/isss.html', category: 'immigration_compliance', categoryTitle: 'Immigration Compliance' }, 
            'AlertTraveler®': { name: 'AlertTraveler®', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />', description: 'Provide 24/7 mobile safety coverage with real-time country intelligence, risk assessments, and proactive emergency communication to travelers.', solves: 'Fulfill Duty of Care with a vital safety tool for instant check-ins and help requests.', color: 'text-td-orange', url: 'https://www.terradotta.com/alerttraveler.html', category: 'travel_solutions', categoryTitle: 'Comprehensive Travel Solutions' }, 
            'Travel Registry': { name: 'Travel Registry', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />', description: 'Consolidate travel information for faculty, staff, and students across all non-credit international activities, creating institutional visibility and accountability.', solves: 'Mitigate institutional risk and streamline reporting for compliance policies like NSPM-33.', color: 'text-td-orange', url: 'https://www.terradotta.com/travel-registry.html', category: 'travel_solutions', categoryTitle: 'Comprehensive Travel Solutions' }, 
            'Agreements Management': { name: 'Agreements Management', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />', description: 'Digitize your partnership lifecycle with an online proposal system that captures agreement details and manages ongoing institutional relationships.', solves: 'Visualize your global footprint and ensure partnership equity by tracking exchange balances.', color: 'text-td-green', url: 'https://www.terradotta.com/agreements-mgmt.html', category: 'partnership_compliance', categoryTitle: 'Partnership & Compliance Management' }, 
            'Engage': { name: 'Engage', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-2.236 9.168-5.514C18.358 1.84 18.668 1.5 19 1.5s.642.34 1.001.986C21.375 5.236 22.91 9.9 21.832 14h-1.258a4.5 4.5 0 01-4.256-3h-.17a4.5 4.5 0 01-4.256 3H5.436z" />', description: 'Connect with prospective participants earlier in their journey, intelligently match students to appropriate programs, and streamline event management for information sessions and recruitment activities.', solves: 'Manage the full student journey to increase program pipeline and participation.', color: 'text-td-green', url: 'https://www.terradotta.com/engage.html', category: 'student_engagement', categoryTitle: 'Student Engagement & Program Matching' }, 
            'Payment Gateway': { name: 'Payment Gateway', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />', description: 'Integrate a secure, reliable payment processing system into your Terra Dotta site.', solves: 'Simplify and secure the collection of application fees and program deposits.', color: 'text-td-orange', url: 'https://www.terradotta.com/solutions', category: 'financial_management', categoryTitle: 'Financial Management' }, 
            'Dashboards': { name: 'Dashboards', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />', description: 'Transform your data into actionable insights by tracking enrollment trends, diversity metrics, risk assessments, and program performance across all international initiatives.', solves: 'Transform raw data into visual reports to demonstrate ROI and inform strategy.', color: 'text-td-green', url: 'https://www.terradotta.com/dashboards.html', category: 'data_intelligence', categoryTitle: 'Data Intelligence & Reporting' } 
        };
        const roles = { 'avp': 'Associate Vice President (AVP) for Global Education/International Affairs', 'isss_director': 'Director of International Student & Scholar Services (ISSS)', 'sa_director': 'Director of Study Abroad/Education Abroad', 'pdso_dso': 'Principal Designated School Official (PDSO)/Designated School Official (DSO)', 'advisor': 'International Student Advisor', 'recruiter': 'International Recruitment Officer', 'risk': 'Risk Management/Legal Affairs', 'liaison': 'Academic Department Liaison', 'other': 'Other' };
        
        const challengesByRole = { 'avp': [ { id: 'avp_c1', text: 'Struggling to demonstrate the ROI and impact of your global initiatives?', recommends: ['Dashboards'] }, { id: 'avp_c2', text: 'Looking for ways to increase your institution\'s global visibility and brand?', recommends: ['Engage', 'Agreements Management'] }, { id: 'avp_c3', text: 'Concerned about ensuring compliance and managing liability for all institutional travel?', recommends: ['Travel Registry', 'AlertTraveler®'] }, { id: 'avp_c4', text: 'Finding it difficult to manage coordination between multiple global engagement offices.', recommends: ['Agreements Management', 'Study Abroad', 'ISSS'] } ], 'isss_director': [ { id: 'isss_dir_c1', text: 'Tasked with ensuring compliance with constantly changing federal regulations?', recommends: ['ISSS'] }, { id: 'isss_dir_c2', text: 'Need a better way to facilitate student enrollment and guide immigration processes?', recommends: ['ISSS', 'Engage'] }, { id: 'isss_dir_c3', text: 'Finding it hard to track and report on your international student populations?', recommends: ['Dashboards'] }, { id: 'isss_dir_c4', text: 'Is coordinating or having visibility into international student and scholar travel a challenge?', recommends: ['Travel Registry'] } ], 'sa_director': [ { id: 'sa_dir_c1', text: 'Is managing complex program partnerships and provider relationships a major time sink?', recommends: ['Agreements Management'] }, { id: 'sa_dir_c2', text: 'Focused on ensuring student safety and managing institutional liability for all travelers?', recommends: ['Travel Registry', 'AlertTraveler®'] }, { id: 'sa_dir_c3', text: 'Need to demonstrate program effectiveness and track student learning outcomes?', recommends: ['Dashboards'] }, { id: 'sa_dir_c4', text: 'Trying to grow participation by improving how you recruit for and promote programs?', recommends: ['Study Abroad', 'Engage']} , { id: 'sa_dir_c5', text: 'Is collecting application fees or program deposits a manual and time-consuming process?', recommends: ['Payment Gateway'] } ], 'pdso_dso': [ { id: 'pdso_c1', text: 'Worried about updating SEVIS records accurately and within strict legal time limits?', recommends: ['ISSS'] }, { id: 'pdso_c2', text: 'Concerned about mitigating the risk of losing your institutional SEVIS certification?', recommends: ['ISSS', 'Dashboards'] }, { id: 'pdso_c3', text: 'Need a reliable way to ensure both individual and institutional compliance with federal law?', recommends: ['ISSS'] }, { id: 'pdso_c4', text: 'Need a comprehensive way to ensure all institutional travel complies with university policy?', recommends: ['Travel Registry'] } ], 'advisor': [ { id: 'adv_c1', text: 'Overwhelmed with processing documents like F-1 visas and work permits?', recommends: ['ISSS'] }, { id: 'adv_c2', text: 'Struggling to manage heavy caseloads and address complex student needs effectively?', recommends: ['ISSS', 'Dashboards'] }, { id: 'adv_c3', text: 'Finding it difficult to automate routine communications so you can focus on students?', recommends: ['Engage'] }, { id: 'adv_c4', text: 'Do you need visibility into your advisees\' travel plans for better support and safety?', recommends: ['Travel Registry', 'Study Abroad'] } ], 'recruiter': [ { id: 'rec_c1', text: 'Need to streamline recruitment campaigns and track prospect engagement?', recommends: ['Engage'] }, { id: 'rec_c2', text: 'Looking for better ways to measure conversion rates from inquiry to applicant?', recommends: ['Dashboards', 'Engage'] }, { id: 'rec_c3', text: 'Struggling to manage recruitment partnerships and agent relationships?', recommends: ['Agreements Management'] }], 'risk': [ { id: 'risk_c1', text: 'Need a comprehensive duty of care and liability management solution for all travelers?', recommends: ['Travel Registry', 'AlertTraveler®'] }, { id: 'risk_c2', text: 'Looking for a centralized system for contract and international partnership oversight?', recommends: ['Agreements Management'] }, { id: 'risk_c3', text: 'Need a better way to report on risk and compliance across the institution?', recommends: ['Dashboards'] }], 'liaison': [ { id: 'lia_c1', text: 'Need tools to help manage faculty-led programs and their academic integration?', recommends: ['Study Abroad'] }, { id: 'lia_c2', text: 'Do you need departmental access for supporting international students and scholars?', recommends: ['ISSS'] }, { id: 'lia_c3', text: 'Looking for a way to track your department\'s student and faculty travel?', recommends: ['Travel Registry'] }], 'other': [ { id: 'other_c1', text: 'Managing complex SEVIS compliance for your international students?', recommends: ['ISSS'] }, { id: 'other_c2', text: 'Struggling to collect fees from applicants worldwide?', recommends: ['Payment Gateway'] }, { id: 'other_c3', text: 'Worried about how to provide a mobile safety net for your travelers?', recommends: ['AlertTraveler®'] }, { id: 'other_c4', text: 'Need a reliable way to track all university travel for risk and compliance?', recommends: ['Travel Registry'] }, { id: 'other_c5', text: 'Losing potential study abroad students from a disjointed engagement process?', recommends: ['Engage'] }, { id: 'other_c6', text: 'Having trouble managing the lifecycle of your global partnerships?', recommends: ['Agreements Management'] }, { id: 'other_c7', text: 'Struggling to create and share reports from your data to gain actionable insights?', recommends: ['Dashboards'] } ] };

        const focusAreasByRole = {
            'avp': [
                { id: 'focus_avp_data', text: 'Establishing a single source of truth for all global engagement data.', recommends: ['Dashboards', 'Study Abroad', 'ISSS', 'Travel Registry'] },
                { id: 'focus_avp_roi', text: 'Demonstrating the ROI and strategic impact of our global initiatives.', recommends: ['Dashboards'] },
                { id: 'focus_avp_risk', text: 'Ensuring comprehensive safety and risk management for all institutional travel.', recommends: ['AlertTraveler®', 'Travel Registry'] },
                { id: 'focus_avp_reputation', text: "Enhancing our institution's global brand and reputation.", recommends: ['Engage', 'Agreements Management'] },
                { id: 'focus_avp_efficiency', text: 'Streamlining operations across multiple global engagement offices.', recommends: ['Study Abroad', 'ISSS', 'Agreements Management'] }
            ],
            'sa_director': [
                { id: 'focus_sa_apps', text: 'Managing program applications and admissions.', recommends: ['Study Abroad', 'Engage'] },
                { id: 'focus_sa_partners', text: 'Overseeing partnership agreements and relationships.', recommends: ['Agreements Management'] },
                { id: 'focus_sa_safety', text: 'Ensuring traveler safety and managing risk.', recommends: ['AlertTraveler®', 'Travel Registry'] },
                { id: 'focus_sa_reporting', text: 'Reporting on program success and enrollment trends.', recommends: ['Dashboards'] },
            ],
            'isss_director': [
                { id: 'focus_isss_compliance', text: 'Ensuring SEVIS compliance and managing immigration documents.', recommends: ['ISSS'] },
                { id: 'focus_isss_experience', text: 'Improving the international student and scholar experience.', recommends: ['Engage', 'ISSS'] },
                { id: 'focus_isss_travel', text: 'Gaining visibility into international student and scholar travel.', recommends: ['Travel Registry', 'AlertTraveler®'] },
                { id: 'focus_isss_reporting', text: 'Reporting on international populations.', recommends: ['Dashboards'] },
            ],
            'risk': [
                { id: 'focus_risk_duty', text: 'Fulfilling Duty of Care for all institutional travel.', recommends: ['AlertTraveler®', 'Travel Registry'] },
                { id: 'focus_risk_compliance', text: 'Ensuring compliance with travel-related policies (e.g., NSPM-33).', recommends: ['Travel Registry'] },
                { id: 'focus_risk_partnerships', text: 'Gaining oversight of international partnership agreements.', recommends: ['Agreements Management'] },
            ],
            'default': [
                { id: 'focus_all_outbound', text: 'Managing outbound student mobility (Study Abroad).', recommends: ['Study Abroad', 'Engage'] },
                { id: 'focus_all_inbound', text: 'Managing inbound international students and scholars (ISSS).', recommends: ['ISSS'] },
                { id: 'focus_all_travel', text: 'Tracking and ensuring safety for all institutional travel.', recommends: ['Travel Registry', 'AlertTraveler®'] },
                { id: 'focus_all_partners', text: 'Managing international partnership agreements.', recommends: ['Agreements Management'] },
                { id: 'focus_all_data', text: 'Visualizing data and reporting on global initiatives.', recommends: ['Dashboards'] },
            ]
        };

        const competitorPainPoints = [
             { id: 'pain_reminders', text: 'Limited automation for applicant reminders.', recommends: ['Study Abroad', 'Engage'], advantage: 'Unlike other vendors, Terra Dotta offers robust automation for applicant communication, enabling tailored reminders and notifications that efficiently guide applicants through the process. This saves staff time, ensures timely, personalized engagement, and drives higher application completion rates.'},
             { id: 'pain_budget', text: 'Inability to build custom budget sheets within the software.', recommends: ['Study Abroad'], advantage: 'Terra Dotta’s budget sheets offer a fully integrated platform, connecting financial data with program management workflows. With real-time updates, customizable features, and clear cost breakdowns for students, it streamlines collaboration and eliminates manual processes.' },
             { id: 'pain_audit', text: 'Difficulty auditing or tracking applicant progress.', recommends: ['Study Abroad', 'ISSS'], advantage: 'Terra Dotta’s progress audit provides real-time snapshots of applicant progress, offering superior visibility and accountability. It enables staff to track progress, address bottlenecks, and manage workflows efficiently, ensuring a smoother experience.' },
             { id: 'pain_batch', text: 'Limited ability to perform actions on applications in batch.', recommends: ['Study Abroad', 'ISSS'], advantage: 'Terra Dotta’s batch actions offer robust features for managing high application volumes efficiently. It enables bulk updates, communications, and data changes, saving time, reducing manual effort, and ensuring smooth, scalable workflows during peak periods.' },
             { id: 'pain_import', text: 'Inability to import applications in bulk.', recommends: ['Study Abroad'], advantage: 'Terra Dotta’s application import feature enables efficient mass imports, saving time and reducing manual effort. Primarily used during implementation, it streamlines operations and supports high-volume data management.' },
             { id: 'pain_exchange', text: 'Difficulty tracking exchange balances without a separate product.', recommends: ['Agreements Management', 'Study Abroad'], advantage: 'Terra Dotta’s exchange balance functionality streamlines agreement management by tracking exchange student numbers directly within its Study Abroad platform, providing integrated tools for greater visibility, accountability, and simplified partnership management.' },
             { id: 'pain_risk', text: 'An inadequate traveler safety and risk management solution.', recommends: ['AlertTraveler®'], advantage: 'Unlike basic check-in tools, AlertTraveler® offers a comprehensive safety solution with real-time alerts, location tracking, and direct communication. It elevates Terra Dotta beyond application management, providing unmatched duty-of-care capabilities.' },
             { id: 'pain_admins', text: 'Strict limits on administrator accounts and permissions.', recommends: [], advantage: 'Terra Dotta provides unmatched flexibility in user and permission settings, allowing institutions to tailor the system to their processes. Unlike vendors with rigid limits, Terra Dotta adapts to your workflows, ensuring seamless integration and enhanced efficiency.' },
             { id: 'pain_cost', text: 'Unpredictable costs and being "nickeled and dimed" for add-ons.', recommends: [], advantage: 'Terra Dotta offers comprehensive solutions with bundled services and features, providing transparent, predictable pricing. While other vendors may upsell for critical features like SSO or basic integrations, Terra Dotta includes them.' },
             { id: 'pain_payments', text: 'A disconnected or manual payment collection process.', recommends: ['Payment Gateway'], advantage: 'Terra Dotta’s payment gateway integrations are more robust and seamless than others, offering fully integrated solutions that simplify processes for administrators and applicants by automating payment status updates.' },
             { id: 'pain_data', text: 'Inability to create custom reports or visualize data effectively.', recommends: ['Dashboards'], advantage: 'Terra Dotta’s advanced analytics and visualization tools offer customizable reporting without relying on external tools like Excel. It provides real-time insights in a centralized platform, empowering institutions to make data-driven decisions easily.' },
             { id: 'pain_forms', text: 'Losing historical data when editing forms.', recommends: ['Study Abroad', 'ISSS'], advantage: 'Terra Dotta’s form management preserves historical data by versioning. When you edit a form, it creates a new version, ensuring you never lose past submission data—a significant advantage for data retention and quality of life.' },
             { id: 'pain_site', text: 'No option for a public-facing, informational website.', recommends: ['Study Abroad'], advantage: 'Terra Dotta allows partners to have a public-facing website to inform stakeholders, becoming a key part of the recruitment and information-sharing process and eliminating a barrier for prospective students.' }
        ];
        
        const barriers = [ { id: 'barrier_cost', text: 'Overall cost and budget constraints.' }, { id: 'barrier_implementation', text: 'The time and effort required for implementation.' }, { id: 'barrier_buy_in', text: 'Getting internal buy-in from stakeholders and leadership.' }, { id: 'barrier_it', text: 'Limited IT department bandwidth and resources.' }, { id: 'barrier_training', text: 'Concerns about training users and ensuring adoption.' } ];
        const barrierResponses = { 'barrier_cost': { title: 'Regarding Cost & Budget', text: 'We understand budget is a primary concern. Terra Dotta\'s platform approach offers significant long-term ROI by consolidating systems, automating manual tasks to free up staff time, and mitigating costly compliance risks. We offer flexible pricing and can work with you to build a business case that demonstrates clear value to your leadership.' }, 'barrier_implementation': { title: 'Regarding Implementation', text: 'Our dedicated implementation team partners with you every step of the way. We use a proven methodology to ensure a smooth transition, from data migration to system configuration, minimizing disruption to your office and getting you up and running efficiently.' }, 'barrier_buy_in': { title: 'Regarding Internal Buy-In', text: 'Getting everyone on board is key. Our solutions provide clear benefits for every role, from advisors to leadership. The Dashboards tool is specifically designed to help you demonstrate the impact and success of your global programs to stakeholders, making the case for investment clear and compelling.' }, 'barrier_it': { title: 'Regarding IT Bandwidth', text: 'We know IT resources are precious. As a cloud-hosted solution, Terra Dotta manages the infrastructure, security, and updates, significantly reducing the burden on your campus IT team. Our integrations are designed to work seamlessly with existing campus systems.' }, 'barrier_training': { title: 'Regarding Training & Adoption', text: 'User adoption is critical for success. We provide comprehensive training resources, including live sessions, on-demand videos, and detailed documentation. Our intuitive user interface is designed to be user-friendly, ensuring your team can leverage the full power of the platform quickly.' } };
        const valuePropositionByRole = { 'avp': 'AVPs can demonstrate measurable progress toward internationalization goals while ensuring institutional safety and compliance.', 'isss_director': 'Dramatically reduces administrative burden while ensuring 100% SEVIS compliance and enhancing the international student experience.', 'sa_director': 'Enables growth in study abroad participation while maintaining the highest safety standards and operational efficiency.', 'pdso_dso': 'Eliminates SEVIS compliance anxiety through automated workflows and fail-safes, protecting institutional certification while reducing administrative burden.', 'advisor': 'Empowers advisors to focus on high-value student interactions while automating routine tasks and ensuring compliance.', 'recruiter': 'Streamline recruitment campaigns, track prospect engagement, and measure conversion rates to boost international enrollment.', 'risk': 'Provides a comprehensive duty of care and liability management solution for all institutional travel, ensuring traveler safety and centralized oversight.', 'liaison': 'Empowers academic departments with tools for faculty-led program management and seamless support for international students and scholars.', 'other': 'Terra Dotta\'s comprehensive platform addresses core challenges across global education, from strategic leadership to day-to-day compliance.' };
        const usStates = ["Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"];
        const directorEmailsByState = { 'Alaska': 'jeralyn.woodall@terradotta.com', 'Alabama': 'laura.matrazzo@terradotta.com', 'Arkansas': 'jeralyn.woodall@terradotta.com', 'Arizona': 'chelsea.curtis@terradotta.com', 'California': 'chelsea.curtis@terradotta.com', 'Colorado': 'jeralyn.woodall@terradotta.com', 'Connecticut': 'george.hogan@terradotta.com', 'District of Columbia': 'laura.matrazzo@terradotta.com', 'Delaware': 'george.hogan@terradotta.com', 'Florida': 'laura.matrazzo@terradotta.com', 'Georgia': 'laura.matrazzo@terradotta.com', 'Hawaii': 'chelsea.curtis@terradotta.com', 'Iowa': 'frank.merendino@terradotta.com', 'Idaho': 'chelsea.curtis@terradotta.com', 'Illinois': 'frank.merendino@terradotta.com', 'Indiana': 'frank.merendino@terradotta.com', 'Kansas': 'jeralyn.woodall@terradotta.com', 'Kentucky': 'frank.merendino@terradotta.com', 'Louisiana': 'jeralyn.woodall@terradotta.com', 'Massachusetts': 'george.hogan@terradotta.com', 'Maryland': 'george.hogan@terradotta.com', 'Maine': 'george.hogan@terradotta.com', 'Michigan': 'frank.merendino@terradotta.com', 'Minnesota': 'frank.merendino@terradotta.com', 'Missouri': 'jeralyn.woodall@terradotta.com', 'Mississippi': 'laura.matrazzo@terradotta.com', 'Montana': 'chelsea.curtis@terradotta.com', 'North Carolina': 'laura.matrazzo@terradotta.com', 'North Dakota': 'jeralyn.woodall@terradotta.com', 'Nebraska': 'jeralyn.woodall@terradotta.com', 'New Hampshire': 'george.hogan@terradotta.com', 'New Jersey': 'george.hogan@terradotta.com', 'New Mexico': 'jeralyn.woodall@terradotta.com', 'Nevada': 'chelsea.curtis@terradotta.com', 'New York': 'george.hogan@terradotta.com', 'Ohio': 'frank.merendino@terradotta.com', 'Oklahoma': 'jeralyn.woodall@terradotta.com', 'Oregon': 'chelsea.curtis@terradotta.com', 'Pennsylvania': 'george.hogan@terradotta.com', 'Rhode Island': 'george.hogan@terradotta.com', 'South Carolina': 'laura.matrazzo@terradotta.com', 'South Dakota': 'jeralyn.woodall@terradotta.com', 'Tennessee': 'laura.matrazzo@terradotta.com', 'Texas': 'jeralyn.woodall@terradotta.com', 'Utah': 'chelsea.curtis@terradotta.com', 'Virginia': 'laura.matrazzo@terradotta.com', 'Vermont': 'george.hogan@terradotta.com', 'Washington': 'chelsea.curtis@terradotta.com', 'Wisconsin': 'frank.merendino@terradotta.com', 'West Virginia': 'laura.matrazzo@terradotta.com', 'Wyoming': 'chelsea.curtis@terradotta.com' };
        
        // --- DOM ELEMENTS ---
        const locationError = document.getElementById('location-error');
        const stateDropdownContainer = document.getElementById('state-dropdown-container');
        const stateDropdown = document.getElementById('state-dropdown');
        const rolesContainer = document.getElementById('roles');
        const roleError = document.getElementById('role-error');
        const currentSolutionsContainer = document.getElementById('currentSolutions');
        const challengesContainer = document.getElementById('challenges');
        const barriersContainer = document.getElementById('barriers');
        const currentResultsContainer = document.getElementById('currentResults');
        const recommendedResultsContainer = document.getElementById('recommendedResults');
        const benefitsContainer = document.getElementById('benefits');
        const valuePropositionText = document.getElementById('value-proposition-text');
        const barrierResponsesContainer = document.getElementById('barrier-responses-container');
        const barrierResponsesContent = document.getElementById('barrier-responses');
        const advantageContainer = document.getElementById('advantage-container');
        const advantageResponsesContent = document.getElementById('advantage-responses');
        const confirmationModal = document.getElementById('confirmation-modal');
        const connectDirectorBtn = document.getElementById('connect-director-btn');
        const notificationContainer = document.getElementById('notification-container');
        const progressSteps = document.querySelectorAll('.progress-step');
        const noSolutionsBtn = document.getElementById('no-solutions-btn');
        const competitorBtn = document.getElementById('competitor-btn');
        const challengesPrompt = document.getElementById('challenges-prompt');

        let currentStep = 1;
        let selectedDirectorEmail = null;
        let sessionData = {};
        let isNewUserPath = false;
        let isCompetitorUserPath = false;
        let isInternationalUser = false;

        // --- NOTIFICATION SYSTEM ---
        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.createElement('div');
            notification.className = `notification max-w-sm bg-white border-l-4 p-4 rounded-lg shadow-lg ${
                type === 'success' ? 'border-td-green' : 
                type === 'error' ? 'border-red-500' : 
                type === 'info' ? 'border-td-blue' : 'border-td-orange'
            }`;
            
            const icon = type === 'success' ? '✓' : type === 'error' ? '✗' : type === 'info' ? 'ℹ' : '⚠';
            const color = type === 'success' ? 'text-td-green' : 
                          type === 'error' ? 'text-red-500' : 
                          type === 'info' ? 'text-td-blue' : 'text-td-orange';
            
            notification.innerHTML = `
                <div class="flex items-start">
                    <span class="font-bold text-lg ${color} mr-3">${icon}</span>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-slate-800">${message}</p>
                    </div>
                    <button class="ml-2 text-slate-400 hover:text-slate-600" onclick="this.parentElement.parentElement.remove()">×</button>
                </div>
            `;
            
            notificationContainer.appendChild(notification);
            
            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.classList.add('removing');
                        setTimeout(() => notification.remove(), 300);
                    }
                }, duration);
            }
        }
        
        // --- PROGRESS TRACKING ---
        function updateProgress(step) {
            progressSteps.forEach((stepEl, index) => {
                stepEl.classList.remove('current', 'completed');
                if (index + 1 < step) {
                    stepEl.classList.add('completed');
                } else if (index + 1 === step) {
                    stepEl.classList.add('current');
                }
            });
            trackSelection('currentStep', step);
        }
        
        function trackSelection(key, value) {
            sessionData.selections[key] = value;
        }

        function trackCheckboxSelection(name, value, isChecked) {
            if (!sessionData.selections[name]) {
                sessionData.selections[name] = [];
            }
            if (isChecked) {
                if (!sessionData.selections[name].includes(value)) {
                    sessionData.selections[name].push(value);
                }
            } else {
                sessionData.selections[name] = sessionData.selections[name].filter(v => v !== value);
            }
        }
        
        // --- UTILITY FUNCTIONS ---
        function createRadio(id, name, value, labelText) {
            const div = document.createElement('div');
            div.className = 'flex items-start';
            div.innerHTML = `<input id="${id}" name="${name}" type="radio" value="${value}" class="custom-radio h-5 w-5 rounded-full border-gray-300 text-td-blue focus:ring-td-blue flex-shrink-0 mt-1">
                             <label for="${id}" class="ml-3 text-md text-slate-600">${labelText}</label>`;
            const input = div.querySelector('input');
            input.addEventListener('change', () => trackSelection(name, value));
            return div;
        }
        
        function createCheckbox(id, name, value, labelText) {
            const div = document.createElement('div');
            div.className = 'flex items-start';
            div.innerHTML = `<input id="${id}" name="${name}" type="checkbox" value="${value}" class="custom-checkbox h-5 w-5 rounded border-gray-300 text-td-blue focus:ring-td-blue flex-shrink-0 mt-1">
                             <label for="${id}" class="ml-3 text-md text-slate-600">${labelText}</label>`;
            const input = div.querySelector('input');
            input.addEventListener('change', (event) => trackCheckboxSelection(name, value, event.target.checked));
            return div;
        }
        
        function createSolutionCard(key, isFaded = false) { 
            const solution = solutions[key]; 
            if (!solution) return ''; 
            const opacityClass = isFaded ? 'opacity-60' : ''; 
            const cardContent = `<div class="flex items-center"><div class="flex-shrink-0 bg-slate-100 ${solution.color} rounded-lg p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">${solution.icon}</svg></div><h4 class="font-bold text-md ml-3 text-slate-800">${key}</h4></div><p class="text-slate-500 text-sm mt-2 flex-grow">${solution.description}</p>`; 
            return isFaded || !solution.url ? `<div class="bg-white p-4 rounded-xl border border-slate-200 flex flex-col h-full ${opacityClass}">${cardContent}</div>` : `<a href="${solution.url}" target="_blank" class="block no-underline card-hover text-current"><div class="bg-white p-4 rounded-xl border border-slate-200 flex flex-col h-full">${cardContent}</div></a>`; 
        }

        // --- INITIALIZATION ---
        function initializeTool() {
            rolesContainer.innerHTML = '';
            currentSolutionsContainer.innerHTML = '';
            stateDropdown.innerHTML = '<option value="">Select your state...</option>';

            Object.keys(roles).forEach(key => { 
                rolesContainer.appendChild(createRadio(`role_${key}`, 'role', key, roles[key])); 
            });
            Object.keys(solutions).forEach(key => { 
                currentSolutionsContainer.appendChild(createCheckbox(`current_${key.replace(/[^a-zA-Z0-9]/g, '')}`, 'currentSolutions', key, key)); 
            });
            usStates.forEach(state => { stateDropdown.innerHTML += `<option value="${state}">${state}</option>`; });
            
            sessionData = {
                sessionId: 'session' + Date.now(),
                startTime: new Date().toISOString(),
                selections: {},
                completed: false
            };
            isNewUserPath = false;
            isCompetitorUserPath = false;
            isInternationalUser = false;
            updateProgress(1);
        }
        
        function goToStep(stepNumber) { 
            document.getElementById(`step${currentStep}`).classList.add('hidden'); 
            document.getElementById(`step${stepNumber}`).classList.remove('hidden'); 
            currentStep = stepNumber; 
            updateProgress(stepNumber);
            
            if (stepNumber > 1 && stepNumber < 6) {
                showNotification(`Step ${stepNumber - 1} completed!`, 'success', 2000);
            }
        }

        // --- UI INTERACTION LISTENERS ---
        document.querySelectorAll('input[name="location"]').forEach(radio => {
            radio.addEventListener('change', (event) => {
                isInternationalUser = event.target.value === 'intl';
                if (event.target.value === 'us') {
                    stateDropdownContainer.classList.remove('hidden');
                } else {
                    stateDropdownContainer.classList.add('hidden');
                    stateDropdown.value = '';
                    selectedDirectorEmail = 'daisy.gould@terradotta.com';
                    trackSelection('location', 'intl');
                }
                locationError.classList.add('hidden');
            });
        });

        noSolutionsBtn.addEventListener('click', () => {
            isNewUserPath = true;
            isCompetitorUserPath = false;
            document.querySelectorAll('input[name="currentSolutions"]').forEach(cb => {
                cb.checked = false;
                trackCheckboxSelection('currentSolutions', cb.value, false);
            });
            populateChallenges();
            goToStep(4);
        });

        competitorBtn.addEventListener('click', () => {
            isNewUserPath = false;
            isCompetitorUserPath = true;
            document.querySelectorAll('input[name="currentSolutions"]').forEach(cb => {
                cb.checked = false;
                trackCheckboxSelection('currentSolutions', cb.value, false);
            });
            populateChallenges();
            goToStep(4);
        });
        
        // --- NAVIGATION BUTTON LISTENERS ---
        document.getElementById('next-btn-1').addEventListener('click', () => {
            const location = document.querySelector('input[name="location"]:checked');
            if (!location) {
                locationError.textContent = "Please select a location to continue.";
                locationError.classList.remove('hidden'); 
                showNotification('Please select your location first', 'error');
                return; 
            }
            if(location.value === 'us'){
                if (!stateDropdown.value){
                    locationError.textContent = "Please select your state to continue.";
                    locationError.classList.remove('hidden'); 
                    showNotification('Please select your state', 'error');
                    return;
                }
                selectedDirectorEmail = directorEmailsByState[stateDropdown.value] || null;
                trackSelection('location', 'us');
                trackSelection('state', stateDropdown.value);
            }
            locationError.classList.add('hidden');
            setupStep2();
            goToStep(2);
        });

        document.getElementById('back-btn-2').addEventListener('click', () => goToStep(1));
        document.getElementById('next-btn-2').addEventListener('click', () => {
            const roleSelected = document.querySelector('input[name="role"]:checked');
            if (!roleSelected) { 
                roleError.classList.remove('hidden'); 
                showNotification('Please select your role first', 'error');
                return; 
            }
            roleError.classList.add('hidden');
            setupStep3();
            goToStep(3);
        });

        document.getElementById('back-btn-3').addEventListener('click', () => goToStep(2));
        document.getElementById('next-btn-3').addEventListener('click', () => {
            isNewUserPath = false;
            isCompetitorUserPath = false;
            populateChallenges(); 
            goToStep(4);
        });

        document.getElementById('back-btn-4').addEventListener('click', () => goToStep(3));
        document.getElementById('next-btn-4').addEventListener('click', () => {
            populateBarriers();
            goToStep(5);
        });
        
        document.getElementById('back-btn-5').addEventListener('click', () => goToStep(4));
        document.getElementById('results-btn').addEventListener('click', showResults);
        
        function setupStep2() {
            const rolesToHide = ['isss_director', 'pdso_dso', 'advisor'];
            rolesToHide.forEach(roleKey => {
                const roleInput = document.querySelector(`input[value="${roleKey}"]`);
                if (roleInput) {
                    roleInput.parentElement.style.display = isInternationalUser ? 'none' : 'flex';
                }
            });
        }
        
        function setupStep3() {
            const isssSolutionCheckbox = document.querySelector('input[value="ISSS"]');
            if(isssSolutionCheckbox){
                 isssSolutionCheckbox.parentElement.style.display = isInternationalUser ? 'none' : 'flex';
            }
        }

        function populateChallenges() {
            challengesContainer.innerHTML = '';
            const selectedRole = document.querySelector('input[name="role"]:checked')?.value || 'other';
            const step4Title = document.querySelector('#step4 h2');

            // Default layout and title
            challengesContainer.className = 'grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4';
            step4Title.textContent = 'Your Challenges';

            if (isNewUserPath) {
                let focusAreas = focusAreasByRole[selectedRole] || focusAreasByRole['default'];
                step4Title.textContent = 'Your Focus Areas';
                if (selectedRole === 'avp') {
                    step4Title.textContent = 'Your Challenges';
                    challengesPrompt.innerHTML = "As a leader, your challenges are unique. Select the areas where you're facing the most pressure.";
                    challengesContainer.className = 'space-y-4';
                    const avpFocusOrder = ['focus_avp_data', 'focus_avp_roi', 'focus_avp_risk', 'focus_avp_reputation', 'focus_avp_efficiency'];
                    focusAreas.sort((a, b) => avpFocusOrder.indexOf(a.id) - avpFocusOrder.indexOf(b.id));

                    avpFocusOrder.forEach(focusId => {
                        const area = focusAreas.find(a => a.id === focusId);
                        if (area) {
                             if (!isInternationalUser || !area.recommends.includes('ISSS')){
                                challengesContainer.appendChild(createCheckbox(area.id, 'challenges', area.id, area.text));
                             }
                        }
                    });
                    return; // exit function after handling AVP case
                } else {
                    challengesPrompt.innerHTML = "What are your primary objectives? <br/> <span class='text-sm text-slate-400'>Select one or more areas to see how Terra Dotta can help.</span>";
                }

                if (isInternationalUser) {
                    focusAreas = focusAreas.filter(area => !area.recommends.includes('ISSS'));
                }
                focusAreas.forEach(area => {
                    challengesContainer.appendChild(createCheckbox(area.id, 'challenges', area.id, area.text));
                });
            } else if (isCompetitorUserPath) {
                 step4Title.textContent = 'Your Challenges';
                 challengesPrompt.innerHTML = "If you use another vendor, we would love to understand your challenges. <br/> <span class='text-sm text-slate-400'>These are some of the known challenges with other vendors.</span>";
                 let painPoints = competitorPainPoints;
                 if (isInternationalUser) {
                    painPoints = painPoints.filter(p => !p.recommends.includes('ISSS'));
                 }
                 painPoints.forEach(point => {
                    challengesContainer.appendChild(createCheckbox(point.id, 'challenges', point.id, point.text));
                });
            } else {
                challengesPrompt.textContent = "Based on your role, what are your biggest challenges right now? Select all that apply.";
                let challengesForRole = challengesByRole[selectedRole];
                
                if (isInternationalUser) {
                    challengesForRole = challengesForRole.filter(c => !c.recommends.includes('ISSS'));
                }
            
                challengesForRole.forEach(challenge => { 
                    challengesContainer.appendChild(createCheckbox(challenge.id, 'challenges', challenge.id, challenge.text)); 
                });
            
                const ownedSolutions = Array.from(document.querySelectorAll('input[name="currentSolutions"]:checked')).map(cb => cb.value);
                const challengesToHide = new Set();
                challengesForRole.forEach(challenge => {
                    const challengeIsSolved = challenge.recommends.every(rec => ownedSolutions.includes(rec));
                    if (challengeIsSolved) { challengesToHide.add(challenge.id); }
                });
                challengesForRole.forEach(challenge => {
                    const challengeElement = document.getElementById(challenge.id)?.parentElement;
                    if (challengeElement) { challengeElement.style.display = challengesToHide.has(challenge.id) ? 'none' : 'flex'; }
                });
            }
        }
        
        function populateBarriers() { 
            barriersContainer.innerHTML = ''; 
            barriers.forEach(barrier => { 
                barriersContainer.appendChild(createCheckbox(barrier.id, 'barriers', barrier.id, barrier.text)); 
            }); 
        }
        
        function showResults() {
            if (selectedDirectorEmail) {
                connectDirectorBtn.classList.remove('hidden');
            } else {
                connectDirectorBtn.classList.add('hidden');
            }

            const ownedSolutions = Array.from(document.querySelectorAll('input[name="currentSolutions"]:checked')).map(cb => cb.value);
            const selectedChallengeIds = Array.from(document.querySelectorAll('input[name="challenges"]:checked')).map(cb => cb.value);
            const selectedBarrierIds = Array.from(document.querySelectorAll('input[name="barriers"]:checked')).map(cb => cb.value);
            const selectedRole = document.querySelector('input[name="role"]:checked')?.value || 'other';
            
            const allPossibleChallenges = [...Object.values(challengesByRole).flat(), ...Object.values(focusAreasByRole).flat(), ...competitorPainPoints];

            let recommendations = new Set();
            let advantageText = '';
            selectedChallengeIds.forEach(challengeId => { 
                const challenge = allPossibleChallenges.find(p => p.id === challengeId); 
                if (challenge) { 
                    challenge.recommends.forEach(rec => recommendations.add(rec)); 
                    if (challenge.advantage) {
                        advantageText += `<div class="p-4 bg-slate-50 rounded-lg"><h4 class="font-semibold text-slate-800">${challenge.text}</h4><p class="text-slate-600 text-sm mt-1">${challenge.advantage}</p></div>`;
                    }
                } 
            });

            if(isCompetitorUserPath && advantageText){
                advantageContainer.classList.remove('hidden');
                advantageResponsesContent.innerHTML = advantageText;
            } else {
                advantageContainer.classList.add('hidden');
            }

            const finalRecommendations = [...recommendations].filter(rec => !ownedSolutions.includes(rec));
            
            barrierResponsesContent.innerHTML = '';
            if (selectedBarrierIds.length > 0) {
                barrierResponsesContainer.classList.remove('hidden');
                selectedBarrierIds.forEach(barrierId => { 
                    const response = barrierResponses[barrierId]; 
                    if (response) { 
                        barrierResponsesContent.innerHTML += `<div class="p-4 bg-slate-50 rounded-lg"><h4 class="font-semibold text-slate-800">${response.title}</h4><p class="text-slate-600 text-sm mt-1">${response.text}</p></div>`; 
                    } 
                });
            } else { 
                barrierResponsesContainer.classList.add('hidden'); 
            }

            currentResultsContainer.innerHTML = ownedSolutions.length > 0 ? ownedSolutions.map(key => createSolutionCard(key, true)).join('') : `<p class="text-slate-500 text-center p-8 border-2 border-dashed rounded-lg">You didn't select any current solutions.</p>`;
            
            if (finalRecommendations.length > 0) {
                recommendedResultsContainer.innerHTML = finalRecommendations.map(key => createSolutionCard(key)).join('');
            } else if (selectedChallengeIds.length > 0) {
                recommendedResultsContainer.innerHTML = `<div class="text-center p-8 border-2 border-dashed border-td-green rounded-lg bg-green-50"><h4 class="font-bold text-td-green mb-2">You're Covered!</h4><p class="text-slate-600">Based on the challenges you selected, your current solutions have you covered.</p></div>`;
            } else {
                recommendedResultsContainer.innerHTML = `<p class="text-slate-500 text-center p-8 border-2 border-dashed rounded-lg">Select a challenge in Step 4 to see recommendations.</p>`;
            }

            valuePropositionText.textContent = valuePropositionByRole[selectedRole];
            const allBenefits = new Set();
            const allSolutionsList = [...ownedSolutions, ...finalRecommendations];
            allSolutionsList.forEach(key => { 
                if(solutions[key] && solutions[key].solves) { 
                    allBenefits.add(solutions[key].solves); 
                } 
            });
            benefitsContainer.innerHTML = allBenefits.size > 0 ? [...allBenefits].map(benefit => `<li>${benefit}</li>`).join('') : `<p class="text-slate-500 text-center col-span-full">Your benefits will appear here once you select solutions and challenges.</p>`;
            
            sessionData.completed = true;
            sessionData.completedTime = new Date().toISOString();
            sessionData.finalRecommendations = finalRecommendations;
            sessionData.ownedSolutions = ownedSolutions;
            
            showNotification('Recommendations generated! 🎉', 'success');
            goToStep(6);
        }
        
        function resetFinder() {
            document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(cb => cb.checked = false);
            locationError.classList.add('hidden');
            roleError.classList.add('hidden');
            stateDropdownContainer.classList.add('hidden');
            stateDropdown.value = '';
            barrierResponsesContainer.classList.add('hidden');
            advantageContainer.classList.add('hidden');
            connectDirectorBtn.classList.add('hidden');
            showNotification('Tool reset successfully', 'info');
            
            initializeTool();
            goToStep(1);
        }
        
        function getResultsForEmail() {
            const ownedSolutions = sessionData.ownedSolutions || [];
            const finalRecommendations = sessionData.finalRecommendations || [];
            const selectedRoleKey = sessionData.selections.role || 'other';

            let body = `Your Key Challenge\r\n`;
            body += `${valuePropositionByRole[selectedRoleKey]}\r\n\r\n`;

            if (ownedSolutions.length > 0) {
                body += 'Core Solution Already in Place\r\n';
                ownedSolutions.forEach(key => {
                    const solution = solutions[key];
                    body += `${solution.name} - ${solution.description}\r\n\r\n`;
                });
            }
            
            if (finalRecommendations.length > 0) {
                body += 'Recommended Strategic Additions\r\n\r\n';
                const categorizedRecs = {};
                finalRecommendations.forEach(key => {
                    const category = solutions[key].category;
                    if (!categorizedRecs[category]) {
                        categorizedRecs[category] = [];
                    }
                    categorizedRecs[category].push(key);
                });
                for (const category in categorizedRecs) {
                    body += `${solutions[categorizedRecs[category][0]].categoryTitle}\r\n`;
                    categorizedRecs[category].forEach(key => {
                        const solution = solutions[key];
                        body += `${solution.name} - ${solution.description}\r\n`;
                    });
                    body += '\r\n';
                }
            }
            return { body, subject: `Terra Dotta Solution Finder Results` };
        }

        // --- FINAL ACTION BUTTON LISTENERS ---
        document.getElementById('reset-btn').addEventListener('click', () => {
            confirmationModal.classList.remove('hidden');
        });
        
        document.getElementById('confirm-reset-btn').addEventListener('click', () => {
            resetFinder();
            confirmationModal.classList.add('hidden');
        });
        
        document.getElementById('cancel-reset-btn').addEventListener('click', () => {
            confirmationModal.classList.add('hidden');
        });

        document.getElementById('print-btn').addEventListener('click', () => {
            showNotification('Preparing document for printing...', 'info', 1000);
            window.print();
        });
        
        document.getElementById('email-btn').addEventListener('click', () => { 
            const { subject, body } = getResultsForEmail(); 
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`; 
            showNotification('Opening email client with your results', 'info');
        });
        
        connectDirectorBtn.addEventListener('click', () => {
            if (!selectedDirectorEmail) return;
            const { subject, body } = getResultsForEmail();
            window.location.href = `mailto:${selectedDirectorEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            showNotification('Connecting you with your local director', 'info');
        });
                
        document.getElementById('back-btn-6').addEventListener('click', () => goToStep(5));

        // --- KICK IT OFF ---
        initializeTool();

    });
    </script>
</body>
</html>
