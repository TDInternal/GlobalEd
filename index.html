<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terra Dotta: Solution Finder</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'td-blue': '#00aeef',
                        'td-green': '#8dc73f',
                        'td-orange': '#f57922',
                        'slate-850': '#1e293b', // Custom dark slate
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 15px rgba(0, 174, 239, 0.3)',
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Base Styles */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }
        
        /* Smooth Transitions for Wizard Steps */
        .wizard-step {
            transition: opacity 0.4s ease, transform 0.4s ease;
            will-change: opacity, transform;
        }

        .wizard-step.hidden {
            opacity: 0;
            transform: translateY(10px);
            position: absolute;
            pointer-events: none;
            display: none; /* Necessary to remove from flow */
        }
        
        /* We override the 'display: none' from the .hidden class in JS by removing the class, 
           but for animations we want the element to exist. 
           However, simple display toggling is safer for layout stability in this specific wizard. */

        /* Custom Form Elements */
        .custom-radio, .custom-checkbox {
            appearance: none;
            background-color: #fff;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1.25em;
            height: 1.25em;
            border: 2px solid #cbd5e1;
            border-radius: 50%;
            display: grid;
            place-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .custom-checkbox {
            border-radius: 0.35em;
        }

        .custom-radio::before, .custom-checkbox::before {
            content: "";
            width: 0.65em;
            height: 0.65em;
            border-radius: 50%;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em white;
            background-color: white;
        }

        .custom-checkbox::before {
            border-radius: 0.15em; /* Square for checkbox */
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
            box-shadow: inset 1em 1em white; /* White checkmark */
        }

        .custom-radio:checked, .custom-checkbox:checked {
            background-color: #00aeef;
            border-color: #00aeef;
        }

        .custom-radio:checked::before, .custom-checkbox:checked::before {
            transform: scale(1);
        }

        /* Label Styling */
        .custom-radio:checked + label, .custom-checkbox:checked + label {
            color: #0f172a; /* Slate 900 */
            font-weight: 600;
        }
        
        label {
            cursor: pointer;
            user-select: none;
        }

        /* Card & Interactions */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            border-color: #00aeef;
        }
        
        /* Benefits List */
        .benefits-list li {
            position: relative;
            padding-left: 32px;
            margin-bottom: 12px;
            line-height: 1.5;
        }
        .benefits-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 4px;
            width: 20px;
            height: 20px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%238dc73f' stroke-width='3'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M5 13l4 4L19 7' /%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        /* Animations */
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .notification { animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .notification.removing { animation: slideOutRight 0.3s ease-in forwards; }

        /* Progress Steps */
        .progress-step { transition: all 0.4s ease; position: relative; z-index: 10; }
        .progress-bar-bg { position: relative; z-index: 1; }
        .progress-bar-fill { transition: width 0.4s ease; }

        /* Print Styles */
        @media print {
            body { background: white !important; }
            header, .wizard-step:not(#step6), #results-actions, #results-back-button, #notification-container, #progress-indicator, #admin-panel { display: none !important; }
            main { margin-top: 0 !important; padding: 0 !important; width: 100% !important; max-width: none !important; }
            #solutionFinder { box-shadow: none !important; padding: 0 !important; margin: 0 !important; }
            #step6 { display: block !important; visibility: visible !important; }
            .break-inside-avoid { break-inside: avoid; }
            a { text-decoration: none !important; color: inherit !important; }
        }
    </style>
</head>
<body class="text-slate-600 antialiased selection:bg-td-blue selection:text-white">
    
    <!-- Notification Container -->
    <div id="notification-container" class="fixed top-6 right-6 z-50 space-y-3 w-full max-w-sm pointer-events-none"></div>

    <!-- Header Banner -->
    <header class="bg-slate-850 text-white text-center pt-16 pb-24 relative overflow-hidden">
        <!-- Abstract Background Shapes -->
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden opacity-10">
            <div class="absolute -top-24 -left-24 w-96 h-96 rounded-full bg-td-blue blur-3xl"></div>
            <div class="absolute top-1/2 right-0 w-64 h-64 rounded-full bg-td-green blur-3xl"></div>
        </div>

        <div class="max-w-5xl mx-auto px-6 relative z-10">
            <p class="text-td-blue font-bold tracking-widest uppercase text-sm mb-3">Terra Dotta Solution Finder</p>
            <h1 class="text-4xl md:text-6xl font-extrabold mb-6 tracking-tight leading-tight">Find Your Solution</h1>
            <p class="text-lg md:text-xl text-slate-300 max-w-2xl mx-auto font-light">
                Answer a few questions about your institution's needs, and we'll recommend the right ecosystem to help you build a more connected campus.
            </p>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 -mt-16 mb-20 relative z-20">
        
        <!-- Progress Indicator -->
        <div id="progress-indicator" class="bg-white px-6 py-5 rounded-t-2xl shadow-soft border-b border-slate-100">
            <div class="max-w-3xl mx-auto">
                <div class="flex justify-between items-center relative">
                    <!-- Connecting Line Background -->
                    <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-full h-1 bg-slate-100 rounded-full -z-0"></div>
                    
                    <!-- Steps -->
                    <div class="relative w-full flex justify-between z-10">
                        <!-- Step 1 -->
                        <div class="flex flex-col items-center cursor-default group">
                            <div class="progress-step current w-10 h-10 rounded-full bg-white border-2 border-slate-200 text-slate-400 flex items-center justify-center text-sm font-bold transition-colors duration-300 shadow-sm" data-step="1">1</div>
                            <span class="text-xs font-medium text-slate-400 mt-2 hidden sm:block">Location</span>
                        </div>
                        <!-- Step 2 -->
                        <div class="flex flex-col items-center cursor-default group">
                            <div class="progress-step w-10 h-10 rounded-full bg-white border-2 border-slate-200 text-slate-400 flex items-center justify-center text-sm font-bold transition-colors duration-300 shadow-sm" data-step="2">2</div>
                            <span class="text-xs font-medium text-slate-400 mt-2 hidden sm:block">Role</span>
                        </div>
                        <!-- Step 3 -->
                        <div class="flex flex-col items-center cursor-default group">
                            <div class="progress-step w-10 h-10 rounded-full bg-white border-2 border-slate-200 text-slate-400 flex items-center justify-center text-sm font-bold transition-colors duration-300 shadow-sm" data-step="3">3</div>
                            <span class="text-xs font-medium text-slate-400 mt-2 hidden sm:block">Status</span>
                        </div>
                        <!-- Step 4 -->
                        <div class="flex flex-col items-center cursor-default group">
                            <div class="progress-step w-10 h-10 rounded-full bg-white border-2 border-slate-200 text-slate-400 flex items-center justify-center text-sm font-bold transition-colors duration-300 shadow-sm" data-step="4">4</div>
                            <span class="text-xs font-medium text-slate-400 mt-2 hidden sm:block">Needs</span>
                        </div>
                        <!-- Step 5 -->
                        <div class="flex flex-col items-center cursor-default group">
                            <div class="progress-step w-10 h-10 rounded-full bg-white border-2 border-slate-200 text-slate-400 flex items-center justify-center text-sm font-bold transition-colors duration-300 shadow-sm" data-step="5">5</div>
                            <span class="text-xs font-medium text-slate-400 mt-2 hidden sm:block">Barriers</span>
                        </div>
                        <!-- Step 6 -->
                        <div class="flex flex-col items-center cursor-default group">
                            <div class="progress-step w-10 h-10 rounded-full bg-white border-2 border-slate-200 text-slate-400 flex items-center justify-center text-sm font-bold transition-colors duration-300 shadow-sm" data-step="6">6</div>
                            <span class="text-xs font-medium text-slate-400 mt-2 hidden sm:block">Results</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Card -->
        <div id="solutionFinder" class="bg-white p-8 md:p-12 rounded-b-2xl shadow-2xl relative min-h-[600px]">
            
            <!-- Step 1: Location -->
            <div id="step1" class="wizard-step">
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-3xl font-bold text-slate-800 mb-3">Where are you located?</h2>
                    <p class="text-slate-500 mb-10 text-lg">This helps us connect you with the right regional resources.</p>
                    
                    <div class="space-y-6">
                        <div class="relative p-4 border border-slate-200 rounded-xl hover:border-td-blue hover:bg-blue-50/30 transition-colors cursor-pointer group">
                            <div class="flex items-center">
                                <input id="location-us" name="location" type="radio" value="us" class="custom-radio flex-shrink-0">
                                <label for="location-us" class="ml-4 text-lg text-slate-700 font-medium w-full h-full block cursor-pointer">Within a US State</label>
                            </div>
                            
                            <!-- Nested Dropdown -->
                            <div id="state-dropdown-container" class="ml-9 mt-4 hidden transition-all duration-300">
                                <select id="state-dropdown" class="w-full md:max-w-sm p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-td-blue focus:border-td-blue bg-white text-slate-700 shadow-sm">
                                    <option value="">Select your state...</option>
                                </select>
                            </div>
                        </div>

                        <div class="relative p-4 border border-slate-200 rounded-xl hover:border-td-blue hover:bg-blue-50/30 transition-colors cursor-pointer">
                            <div class="flex items-center">
                                <input id="location-intl" name="location" type="radio" value="intl" class="custom-radio flex-shrink-0">
                                <label for="location-intl" class="ml-4 text-lg text-slate-700 font-medium w-full h-full block cursor-pointer">Outside the US</label>
                            </div>
                        </div>
                    </div>

                    <div class="mt-12 flex flex-col items-end">
                         <div id="location-error" class="text-red-500 text-sm mb-3 hidden font-medium bg-red-50 px-4 py-2 rounded-lg">Please select a location and state to continue.</div>
                        <button id="next-btn-1" class="bg-td-blue hover:bg-sky-500 text-white font-bold text-lg py-3 px-10 rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200 flex items-center">
                            Next <span class="ml-2">‚Üí</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Role Selection -->
            <div id="step2" class="wizard-step hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-3">What represents your role?</h2>
                <p class="text-slate-500 mb-10 text-lg">We'll tailor the questions to your specific responsibilities.</p>
                
                <div id="roles" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Roles injected by JS -->
                </div>

                <div class="mt-12 flex justify-between items-center border-t border-slate-100 pt-8">
                    <button id="back-btn-2" class="text-slate-500 hover:text-slate-800 font-semibold py-3 px-6 rounded-lg transition-colors flex items-center">
                        <span class="mr-2">‚Üê</span> Back
                    </button>
                    <div class="text-right">
                         <div id="role-error" class="text-red-500 text-sm mb-2 hidden">Please select a role.</div>
                         <button id="next-btn-2" class="bg-td-blue hover:bg-sky-500 text-white font-bold py-3 px-10 rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200">
                            Next ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Current Solutions -->
            <div id="step3" class="wizard-step hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-3">What solutions do you have?</h2>
                <p class="text-slate-500 mb-8 text-lg">Select the Terra Dotta solutions you currently use, or tell us if you're new.</p>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">
                    <button id="no-solutions-btn" class="group relative bg-white border-2 border-td-orange text-td-orange hover:bg-td-orange hover:text-white font-bold py-4 px-6 rounded-xl transition-all shadow-sm hover:shadow-md flex items-center justify-center">
                        <span class="mr-2">‚ú®</span> I'm new to Terra Dotta
                    </button>
                    <button id="competitor-btn" class="group relative bg-white border-2 border-slate-400 text-slate-600 hover:bg-slate-600 hover:text-white font-bold py-4 px-6 rounded-xl transition-all shadow-sm hover:shadow-md flex items-center justify-center">
                        <span class="mr-2">üîÑ</span> I use another vendor
                    </button>
                </div>
                
                <div class="relative">
                    <div class="absolute inset-0 flex items-center" aria-hidden="true">
                        <div class="w-full border-t border-slate-200"></div>
                    </div>
                    <div class="relative flex justify-center">
                        <span class="px-3 bg-white text-slate-400 font-medium text-sm uppercase tracking-wider">Or select current products</span>
                    </div>
                </div>

                <div id="currentSolutions" class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Checkboxes injected by JS -->
                </div>

                <div class="mt-12 flex justify-between items-center border-t border-slate-100 pt-8">
                    <button id="back-btn-3" class="text-slate-500 hover:text-slate-800 font-semibold py-3 px-6 rounded-lg transition-colors flex items-center">
                        <span class="mr-2">‚Üê</span> Back
                    </button>
                    <button id="next-btn-3" class="bg-td-blue hover:bg-sky-500 text-white font-bold py-3 px-10 rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200">
                        Next ‚Üí
                    </button>
                </div>
            </div>

            <!-- Step 3.5: Competitor Focus -->
            <div id="step-competitor-focus" class="wizard-step hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-3">Which office is your focus?</h2>
                <p class="text-slate-500 mb-10 text-lg">Help us narrow down the challenges relevant to you right now.</p>
                
                <div id="competitor-focus-options" class="space-y-4 max-w-2xl mx-auto">
                    <div class="p-5 border border-slate-200 rounded-xl hover:border-td-blue hover:bg-blue-50/30 transition-colors cursor-pointer">
                        <div class="flex items-center">
                            <input id="focus-study-abroad" name="competitor_focus" type="radio" value="study_abroad" class="custom-radio mt-1">
                            <label for="focus-study-abroad" class="ml-4 text-lg text-slate-700 font-medium">Study Abroad / Education Abroad</label>
                        </div>
                    </div>
                    <div class="p-5 border border-slate-200 rounded-xl hover:border-td-blue hover:bg-blue-50/30 transition-colors cursor-pointer">
                        <div class="flex items-center">
                            <input id="focus-isss" name="competitor_focus" type="radio" value="isss" class="custom-radio mt-1">
                            <label for="focus-isss" class="ml-4 text-lg text-slate-700 font-medium">ISSS (International Student & Scholar Services)</label>
                        </div>
                    </div>
                    <div class="p-5 border border-slate-200 rounded-xl hover:border-td-blue hover:bg-blue-50/30 transition-colors cursor-pointer">
                        <div class="flex items-center">
                            <input id="focus-travel-risk" name="competitor_focus" type="radio" value="travel_risk" class="custom-radio mt-1">
                            <label for="focus-travel-risk" class="ml-4 text-lg text-slate-700 font-medium">Travel Risk & Safety</label>
                        </div>
                    </div>
                    <div class="p-5 border border-slate-200 rounded-xl hover:border-td-blue hover:bg-blue-50/30 transition-colors cursor-pointer">
                        <div class="flex items-center">
                            <input id="focus-all" name="competitor_focus" type="radio" value="all" class="custom-radio mt-1">
                            <label for="focus-all" class="ml-4 text-lg text-slate-700 font-medium">All Global Engagement</label>
                        </div>
                    </div>
                </div>

                <div class="mt-12 flex justify-between items-center border-t border-slate-100 pt-8">
                    <button id="back-btn-cf" class="text-slate-500 hover:text-slate-800 font-semibold py-3 px-6 rounded-lg transition-colors flex items-center">
                        <span class="mr-2">‚Üê</span> Back
                    </button>
                    <div class="text-right">
                        <div id="competitor-focus-error" class="text-red-500 text-sm mb-2 hidden">Please select a focus area.</div>
                        <button id="next-btn-cf" class="bg-td-blue hover:bg-sky-500 text-white font-bold py-3 px-10 rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200">
                            Next ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- Specific Pain Point Steps (Hidden by default) -->
            <!-- Study Abroad Pain Points -->
            <div id="step-sa-pains" class="wizard-step hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-3">Study Abroad Challenges</h2>
                <p class="text-slate-500 mb-10 text-lg">Select the issues causing the most friction in your office.</p>
                <div id="sa-pains-container" class="space-y-4"></div>
                <div class="mt-12 flex justify-between items-center border-t border-slate-100 pt-8">
                    <button id="back-btn-sap" class="text-slate-500 hover:text-slate-800 font-semibold py-3 px-6 rounded-lg transition-colors flex items-center">‚Üê Back</button>
                    <button id="next-btn-sap" class="bg-td-blue hover:bg-sky-500 text-white font-bold py-3 px-10 rounded-xl shadow-lg hover:shadow-xl transition-all">Next ‚Üí</button>
                </div>
            </div>

            <!-- ISSS Pain Points -->
            <div id="step-isss-pains" class="wizard-step hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-3">ISSS Challenges</h2>
                <p class="text-slate-500 mb-10 text-lg">What are the biggest hurdles in your compliance workflows?</p>
                <div id="isss-pains-container" class="space-y-4"></div>
                <div class="mt-12 flex justify-between items-center border-t border-slate-100 pt-8">
                    <button id="back-btn-issp" class="text-slate-500 hover:text-slate-800 font-semibold py-3 px-6 rounded-lg transition-colors flex items-center">‚Üê Back</button>
                    <button id="next-btn-issp" class="bg-td-blue hover:bg-sky-500 text-white font-bold py-3 px-10 rounded-xl shadow-lg hover:shadow-xl transition-all">Next ‚Üí</button>
                </div>
            </div>

            <!-- Travel Risk Pain Points -->
            <div id="step-tr-pains" class="wizard-step hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-3">Travel Risk Challenges</h2>
                <p class="text-slate-500 mb-10 text-lg">Identify your primary concerns regarding traveler safety.</p>
                <div id="tr-pains-container" class="space-y-4"></div>
                <div class="mt-12 flex justify-between items-center border-t border-slate-100 pt-8">
                    <button id="back-btn-trp" class="text-slate-500 hover:text-slate-800 font-semibold py-3 px-6 rounded-lg transition-colors flex items-center">‚Üê Back</button>
                    <button id="next-btn-trp" class="bg-td-blue hover:bg-sky-500 text-white font-bold py-3 px-10 rounded-xl shadow-lg hover:shadow-xl transition-all">Next ‚Üí</button>
                </div>
            </div>

            <!-- Step 4: Standard Challenges -->
            <div id="step4" class="wizard-step hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-3">Your Challenges</h2>
                <p id="challenges-prompt" class="text-slate-500 mb-10 text-lg">Based on your role, what keeps you up at night?</p>
                <div id="challenges" class="space-y-4"></div>
                <div class="mt-12 flex justify-between items-center border-t border-slate-100 pt-8">
                    <button id="back-btn-4" class="text-slate-500 hover:text-slate-800 font-semibold py-3 px-6 rounded-lg transition-colors flex items-center">‚Üê Back</button>
                    <button id="next-btn-4" class="bg-td-blue hover:bg-sky-500 text-white font-bold py-3 px-10 rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200">Next ‚Üí</button>
                </div>
            </div>
            
            <!-- Step 5: Barriers -->
            <div id="step5" class="wizard-step hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-3">Potential Barriers</h2>
                <p class="text-slate-500 mb-10 text-lg">What concerns might hold you back from adopting new software?</p>
                <div id="barriers" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <div class="mt-12 flex justify-between items-center border-t border-slate-100 pt-8">
                    <button id="back-btn-5" class="text-slate-500 hover:text-slate-800 font-semibold py-3 px-6 rounded-lg transition-colors flex items-center">‚Üê Back</button>
                    <button id="results-btn" class="bg-td-green hover:bg-green-600 text-white font-bold py-3 px-10 rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200 transform">
                        See My Recommendations
                    </button>
                </div>
            </div>

            <!-- Step 6: Results -->
            <div id="step6" class="wizard-step hidden">
                <div class="text-center mb-10">
                    <span class="bg-blue-100 text-td-blue text-xs font-bold uppercase tracking-wider px-3 py-1 rounded-full">Results</span>
                    <h2 class="text-3xl md:text-4xl font-extrabold text-slate-800 mt-4 mb-2">Your Connected Campus Journey</h2>
                </div>

                <!-- Value Prop -->
                <div id="value-proposition-container" class="bg-gradient-to-r from-blue-50 to-white border-l-4 border-td-blue p-6 rounded-r-lg shadow-sm mb-10 break-inside-avoid">
                    <h3 class="font-bold text-td-blue text-lg flex items-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        Value Proposition for Your Role
                    </h3>
                    <p id="value-proposition-text" class="mt-2 text-slate-700 text-lg leading-relaxed"></p>
                </div>

                <div id="advantage-container" class="mb-10 hidden break-inside-avoid">
                    <h3 class="font-bold text-2xl text-slate-800 mb-6 text-center">The Terra Dotta Advantage</h3>
                    <div id="advantage-responses" class="grid gap-4"></div>
                </div>

                <div id="barrier-responses-container" class="mb-10 hidden break-inside-avoid">
                    <h3 class="font-bold text-2xl text-slate-800 mb-6 text-center">Addressing Your Concerns</h3>
                    <div id="barrier-responses" class="grid gap-4"></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                    <div class="break-inside-avoid">
                        <h3 class="font-bold text-xl text-slate-600 mb-4 flex items-center">
                            <span class="bg-slate-200 text-slate-600 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">1</span>
                            Your Current Ecosystem
                        </h3>
                        <div id="currentResults" class="space-y-4"></div>
                    </div>
                    <div class="break-inside-avoid">
                        <h3 class="font-bold text-xl text-td-green mb-4 flex items-center">
                            <span class="bg-green-100 text-td-green rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">2</span>
                            Recommended Additions
                        </h3>
                        <div id="recommendedResults" class="space-y-4"></div>
                    </div>
                </div>

                <div class="bg-slate-50 rounded-2xl p-8 border border-slate-100 mb-12 break-inside-avoid">
                    <h3 class="font-bold text-2xl text-slate-800 mb-6 text-center">Outcomes You Can Expect</h3>
                    <ul id="benefits" class="benefits-list text-slate-700 grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-3"></ul>
                </div>

                <div id="results-actions" class="text-center bg-slate-850 text-white rounded-2xl p-8 md:p-12 shadow-2xl relative overflow-hidden break-inside-avoid">
                    <div class="relative z-10">
                        <h3 class="text-2xl md:text-3xl font-bold mb-2">Take the Next Step</h3>
                        <p class="text-slate-300 mb-8">Share these results with your team or schedule a personalized demo.</p>
                        
                        <div class="flex flex-wrap justify-center items-center gap-4">
                            <a href="https://www.terradotta.com/request-demo.html" target="_blank" class="w-full sm:w-auto inline-flex items-center justify-center bg-td-green hover:bg-green-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-all">
                                Schedule Demo
                            </a>
                            <button id="connect-director-btn" class="w-full sm:w-auto bg-td-blue hover:bg-sky-500 text-white font-bold py-3 px-8 rounded-lg transition-all hidden shadow-lg">
                                Contact Director
                            </button>
                            <button id="email-btn" class="w-full sm:w-auto bg-white/10 hover:bg-white/20 text-white font-bold py-3 px-8 rounded-lg transition-all backdrop-blur-sm">
                                Email Results
                            </button>
                            <button id="print-btn" class="w-full sm:w-auto bg-white/10 hover:bg-white/20 text-white font-bold py-3 px-8 rounded-lg transition-all backdrop-blur-sm">
                                Print / PDF
                            </button>
                            <button id="reset-btn" class="w-full sm:w-auto text-slate-300 hover:text-white font-medium py-3 px-6 transition-colors">
                                Start Over
                            </button>
                        </div>
                    </div>
                    <!-- Decorative Background Glows -->
                    <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-td-blue rounded-full filter blur-3xl opacity-20"></div>
                    <div class="absolute bottom-0 left-0 -mb-10 -ml-10 w-40 h-40 bg-td-green rounded-full filter blur-3xl opacity-20"></div>
                </div>

                <div id="results-back-button" class="mt-10 flex justify-center">
                    <button id="back-btn-6" class="text-slate-400 hover:text-slate-600 text-sm font-medium flex items-center transition-colors">
                        ‚Üê Back to Barriers
                    </button>
                </div>
            </div>

        </div>
    </main>
    
    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm w-full transform transition-all scale-100">
            <div class="w-16 h-16 bg-orange-100 text-td-orange rounded-full flex items-center justify-center mx-auto mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
            </div>
            <h3 class="text-xl font-bold text-slate-800 mb-2">Restart Solution Finder?</h3>
            <p class="text-slate-500 mb-8">This will clear all your current selections.</p>
            <div class="grid grid-cols-2 gap-4">
                <button id="cancel-reset-btn" class="bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold py-3 px-4 rounded-xl transition-colors">Cancel</button>
                <button id="confirm-reset-btn" class="bg-td-orange hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-colors">Restart</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
    
        // --- DATA OBJECTS ---
        const solutions = { 
            'Study Abroad': { name: 'Study Abroad Platform', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9V3m0 18a9 9 0 009-9M3 12a9 9 0 019-9m0 18a9 9 0 00-9-9m9 9H3" />', description: 'Enhance the applicant experience with a searchable program catalog and seamless online applications.', solves: 'Streamline the entire outbound mobility lifecycle into one manageable hub.', color: 'text-td-blue', url: 'https://www.terradotta.com/study-abroad.html', category: 'application_program_management', categoryTitle: 'Application & Program Management' }, 
            'ISSS': { name: 'ISSS', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656-.126-1.283-.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" />', description: 'Centralize academic records and SEVIS compliance management to streamline visa processes.', solves: 'Reduce administrative burden and SEVIS risk to improve international student yield.', color: 'text-td-blue', url: 'https://www.terradotta.com/isss.html', category: 'immigration_compliance', categoryTitle: 'Immigration Compliance' }, 
            'AlertTraveler¬Æ': { name: 'AlertTraveler¬Æ', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />', description: '24/7 mobile safety coverage with real-time intelligence and proactive emergency communication.', solves: 'Fulfill Duty of Care with a vital safety tool for instant check-ins and help requests.', color: 'text-td-orange', url: 'https://www.terradotta.com/alerttraveler.html', category: 'travel_solutions', categoryTitle: 'Comprehensive Travel Solutions' }, 
            'Travel Registry': { name: 'Travel Registry', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />', description: 'Consolidate travel information across all non-credit international activities.', solves: 'Mitigate institutional risk and streamline reporting for compliance policies.', color: 'text-td-orange', url: 'https://www.terradotta.com/travel-registry.html', category: 'travel_solutions', categoryTitle: 'Comprehensive Travel Solutions' }, 
            'Agreements Management': { name: 'Agreements Management', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />', description: 'Digitize your partnership lifecycle with an online proposal system and agreement tracking.', solves: 'Visualize your global footprint and ensure partnership equity by tracking exchange balances.', color: 'text-td-green', url: 'https://www.terradotta.com/agreements-mgmt.html', category: 'partnership_compliance', categoryTitle: 'Partnership & Compliance Management' }, 
            'Engage': { name: 'Engage', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-2.236 9.168-5.514C18.358 1.84 18.668 1.5 19 1.5s.642.34 1.001.986C21.375 5.236 22.91 9.9 21.832 14h-1.258a4.5 4.5 0 01-4.256-3h-.17a4.5 4.5 0 01-4.256 3H5.436z" />', description: 'Intelligently match students to programs and streamline event management.', solves: 'Manage the full student journey to increase program pipeline and participation.', color: 'text-td-green', url: 'https://www.terradotta.com/engage.html', category: 'student_engagement', categoryTitle: 'Student Engagement & Program Matching' }, 
            'Payment Gateway': { name: 'Payment Gateway', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />', description: 'Integrate a secure, reliable payment processing system into your Terra Dotta site.', solves: 'Simplify and secure the collection of application fees and program deposits.', color: 'text-td-orange', url: 'https://www.terradotta.com/solutions', category: 'financial_management', categoryTitle: 'Financial Management' }, 
            'Dashboards': { name: 'Dashboards', icon: '<path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />', description: 'Transform data into actionable insights by tracking enrollment, diversity, and risk metrics.', solves: 'Transform raw data into visual reports to demonstrate ROI and inform strategy.', color: 'text-td-green', url: 'https://www.terradotta.com/dashboards.html', category: 'data_intelligence', categoryTitle: 'Data Intelligence & Reporting' } 
        };
        const roles = { 'avp': 'Associate VP for Global Education', 'isss_director': 'Director of ISSS', 'sa_director': 'Director of Study Abroad', 'pdso_dso': 'PDSO / DSO', 'advisor': 'International Student Advisor', 'recruiter': 'International Recruitment Officer', 'risk': 'Risk Management / Legal Affairs', 'liaison': 'Academic Department Liaison', 'other': 'Other' };
        
        const challengesByRole = { 'avp': [ { id: 'avp_c1', text: 'Struggling to demonstrate the ROI and impact of your global initiatives?', recommends: ['Dashboards'] }, { id: 'avp_c2', text: 'Looking for ways to increase your institution\'s global visibility and brand?', recommends: ['Engage', 'Agreements Management'] }, { id: 'avp_c3', text: 'Concerned about ensuring compliance and managing liability for all institutional travel?', recommends: ['Travel Registry', 'AlertTraveler¬Æ'] }, { id: 'avp_c4', text: 'Finding it difficult to manage coordination between multiple global engagement offices.', recommends: ['Agreements Management', 'Study Abroad', 'ISSS'] } ], 'isss_director': [ { id: 'isss_dir_c1', text: 'Tasked with ensuring compliance with constantly changing federal regulations?', recommends: ['ISSS'] }, { id: 'isss_dir_c2', text: 'Need a better way to facilitate student enrollment and guide immigration processes?', recommends: ['ISSS', 'Engage'] }, { id: 'isss_dir_c3', text: 'Finding it hard to track and report on your international student populations?', recommends: ['Dashboards'] }, { id: 'isss_dir_c4', text: 'Is coordinating or having visibility into international student and scholar travel a challenge?', recommends: ['Travel Registry'] } ], 'sa_director': [ { id: 'sa_dir_c1', text: 'Is managing complex program partnerships and provider relationships a major time sink?', recommends: ['Agreements Management'] }, { id: 'sa_dir_c2', text: 'Focused on ensuring student safety and managing institutional liability for all travelers?', recommends: ['Travel Registry', 'AlertTraveler¬Æ'] }, { id: 'sa_dir_c3', text: 'Need to demonstrate program effectiveness and track student learning outcomes?', recommends: ['Dashboards'] }, { id: 'sa_dir_c4', text: 'Trying to grow participation by improving how you recruit for and promote programs?', recommends: ['Study Abroad', 'Engage']} , { id: 'sa_dir_c5', text: 'Is collecting application fees or program deposits a manual and time-consuming process?', recommends: ['Payment Gateway'] } ], 'pdso_dso': [ { id: 'pdso_c1', text: 'Worried about updating SEVIS records accurately and within strict legal time limits?', recommends: ['ISSS'] }, { id: 'pdso_c2', text: 'Concerned about mitigating the risk of losing your institutional SEVIS certification?', recommends: ['ISSS', 'Dashboards'] }, { id: 'pdso_c3', text: 'Need a reliable way to ensure both individual and institutional compliance with federal law?', recommends: ['ISSS'] }, { id: 'pdso_c4', text: 'Need a comprehensive way to ensure all institutional travel complies with university policy?', recommends: ['Travel Registry'] } ], 'advisor': [ { id: 'adv_c1', text: 'Overwhelmed with processing documents like F-1 visas and work permits?', recommends: ['ISSS'] }, { id: 'adv_c2', text: 'Struggling to manage heavy caseloads and address complex student needs effectively?', recommends: ['ISSS', 'Dashboards'] }, { id: 'adv_c3', text: 'Finding it difficult to automate routine communications so you can focus on students?', recommends: ['Engage'] }, { id: 'adv_c4', text: 'Do you need visibility into your advisees\' travel plans for better support and safety?', recommends: ['Travel Registry', 'Study Abroad'] } ], 'recruiter': [ { id: 'rec_c1', text: 'Need to streamline recruitment campaigns and track prospect engagement?', recommends: ['Engage'] }, { id: 'rec_c2', text: 'Looking for better ways to measure conversion rates from inquiry to applicant?', recommends: ['Dashboards', 'Engage'] }, { id: 'rec_c3', text: 'Struggling to manage recruitment partnerships and agent relationships?', recommends: ['Agreements Management'] }], 'risk': [ { id: 'risk_c1', text: 'Need a comprehensive duty of care and liability management solution for all travelers?', recommends: ['Travel Registry', 'AlertTraveler¬Æ'] }, { id: 'risk_c2', text: 'Looking for a centralized system for contract and international partnership oversight?', recommends: ['Agreements Management'] }, { id: 'risk_c3', text: 'Need a better way to report on risk and compliance across the institution?', recommends: ['Dashboards'] }], 'liaison': [ { id: 'lia_c1', text: 'Need tools to help manage faculty-led programs and their academic integration?', recommends: ['Study Abroad'] }, { id: 'lia_c2', text: 'Do you need departmental access for supporting international students and scholars?', recommends: ['ISSS'] }, { id: 'lia_c3', text: 'Looking for a way to track your department\'s student and faculty travel?', recommends: ['Travel Registry'] }], 'other': [ { id: 'other_c1', text: 'Managing complex SEVIS compliance for your international students?', recommends: ['ISSS'] }, { id: 'other_c2', text: 'Struggling to collect fees from applicants worldwide?', recommends: ['Payment Gateway'] }, { id: 'other_c3', text: 'Worried about how to provide a mobile safety net for your travelers?', recommends: ['AlertTraveler¬Æ'] }, { id: 'other_c4', text: 'Need a reliable way to track all university travel for risk and compliance?', recommends: ['Travel Registry'] }, { id: 'other_c5', text: 'Losing potential study abroad students from a disjointed engagement process?', recommends: ['Engage'] }, { id: 'other_c6', text: 'Having trouble managing the lifecycle of your global partnerships?', recommends: ['Agreements Management'] }, { id: 'other_c7', text: 'Struggling to create and share reports from your data to gain actionable insights?', recommends: ['Dashboards'] } ] };

        const focusAreasByRole = {
            'avp': [
                { id: 'focus_avp_data', text: 'Establishing a single source of truth for all global engagement data.', recommends: ['Dashboards', 'Study Abroad', 'ISSS', 'Travel Registry'] },
                { id: 'focus_avp_roi', text: 'Demonstrating the ROI and strategic impact of our global initiatives.', recommends: ['Dashboards'] },
                { id: 'focus_avp_risk', text: 'Ensuring comprehensive safety and risk management for all institutional travel.', recommends: ['AlertTraveler¬Æ', 'Travel Registry'] },
                { id: 'focus_avp_reputation', text: "Enhancing our institution's global brand and reputation.", recommends: ['Engage', 'Agreements Management'] },
                { id: 'focus_avp_efficiency', text: 'Streamlining operations across multiple global engagement offices.', recommends: ['Study Abroad', 'ISSS', 'Agreements Management'] }
            ],
            'sa_director': [
                { id: 'focus_sa_apps', text: 'Managing program applications and admissions.', recommends: ['Study Abroad', 'Engage'] },
                { id: 'focus_sa_partners', text: 'Overseeing partnership agreements and relationships.', recommends: ['Agreements Management'] },
                { id: 'focus_sa_safety', text: 'Ensuring traveler safety and managing risk.', recommends: ['AlertTraveler¬Æ', 'Travel Registry'] },
                { id: 'focus_sa_reporting', text: 'Reporting on program success and enrollment trends.', recommends: ['Dashboards'] },
            ],
            'isss_director': [
                { id: 'focus_isss_compliance', text: 'Ensuring SEVIS compliance and managing immigration documents.', recommends: ['ISSS'] },
                { id: 'focus_isss_experience', text: 'Improving the international student and scholar experience.', recommends: ['Engage', 'ISSS'] },
                { id: 'focus_isss_travel', text: 'Gaining visibility into international student and scholar travel.', recommends: ['Travel Registry', 'AlertTraveler¬Æ'] },
                { id: 'focus_isss_reporting', text: 'Reporting on international populations.', recommends: ['Dashboards'] },
            ],
            'risk': [
                { id: 'focus_risk_duty', text: 'Fulfilling Duty of Care for all institutional travel.', recommends: ['AlertTraveler¬Æ', 'Travel Registry'] },
                { id: 'focus_risk_compliance', text: 'Ensuring compliance with travel-related policies (e.g., NSPM-33).', recommends: ['Travel Registry'] },
                { id: 'focus_risk_partnerships', text: 'Gaining oversight of international partnership agreements.', recommends: ['Agreements Management'] },
            ],
            'default': [
                { id: 'focus_all_outbound', text: 'Managing outbound student mobility (Study Abroad).', recommends: ['Study Abroad', 'Engage'] },
                { id: 'focus_all_inbound', text: 'Managing inbound international students and scholars (ISSS).', recommends: ['ISSS'] },
                { id: 'focus_all_travel', text: 'Tracking and ensuring safety for all institutional travel.', recommends: ['Travel Registry', 'AlertTraveler¬Æ'] },
                { id: 'focus_all_partners', text: 'Managing international partnership agreements.', recommends: ['Agreements Management'] },
                { id: 'focus_all_data', text: 'Visualizing data and reporting on global initiatives.', recommends: ['Dashboards'] },
            ]
        };

        const competitorPainPoints = [
             { id: 'pain_reminders', text: 'Limited automation for applicant reminders.', recommends: ['Study Abroad', 'Engage'], advantage: 'Unlike other vendors, Terra Dotta offers robust automation for applicant communication, enabling tailored reminders and notifications that efficiently guide applicants through the process. This saves staff time, ensures timely, personalized engagement, and drives higher application completion rates.', focus: ['study_abroad', 'all']},
             { id: 'pain_budget', text: 'Inability to build custom budget sheets within the software.', recommends: ['Study Abroad'], advantage: 'Terra Dotta‚Äôs budget sheets offer a fully integrated platform, connecting financial data with program management workflows. With real-time updates, customizable features, and clear cost breakdowns for students, it streamlines collaboration and eliminates manual processes.', focus: ['study_abroad', 'all'] },
             { id: 'pain_audit', text: 'Difficulty auditing or tracking applicant progress.', recommends: ['Study Abroad', 'ISSS'], advantage: 'Terra Dotta‚Äôs progress audit provides real-time snapshots of applicant progress, offering superior visibility and accountability. It enables staff to track progress, address bottlenecks, and manage workflows efficiently, ensuring a smoother experience.', focus: ['study_abroad', 'isss', 'all'] },
             { id: 'pain_batch', text: 'Limited ability to perform actions on applications in batch.', recommends: ['Study Abroad', 'ISSS'], advantage: 'Terra Dotta‚Äôs batch actions offer robust features for managing high application volumes efficiently. It enables bulk updates, communications, and data changes, saving time, reducing manual effort, and ensuring smooth, scalable workflows during peak periods.', focus: ['study_abroad', 'isss', 'all'] },
             { id: 'pain_import', text: 'Inability to import applications in bulk.', recommends: ['Study Abroad'], advantage: 'Terra Dotta‚Äôs application import feature enables efficient mass imports, saving time and reducing manual effort. Primarily used during implementation, it streamlines operations and supports high-volume data management.', focus: ['study_abroad', 'all'] },
             { id: 'pain_exchange', text: 'Difficulty tracking exchange balances without a separate product.', recommends: ['Agreements Management', 'Study Abroad'], advantage: 'Terra Dotta‚Äôs exchange balance functionality streamlines agreement management by tracking exchange student numbers directly within its Study Abroad platform, providing integrated tools for greater visibility, accountability, and simplified partnership management.', focus: ['study_abroad', 'all'] },
             { id: 'pain_risk', text: 'An inadequate traveler safety and risk management solution.', recommends: ['AlertTraveler¬Æ'], advantage: 'Unlike basic check-in tools, AlertTraveler¬Æ offers a comprehensive safety solution with real-time alerts, location tracking, and direct communication. It elevates Terra Dotta beyond application management, providing unmatched duty-of-care capabilities.', focus: ['travel_risk', 'all'] },
             { id: 'pain_admins', text: 'Strict limits on administrator accounts and permissions.', recommends: [], advantage: 'Terra Dotta provides unmatched flexibility in user and permission settings, allowing institutions to tailor the system to their processes. Unlike vendors with rigid limits, Terra Dotta adapts to your workflows, ensuring seamless integration and enhanced efficiency.', focus: ['study_abroad', 'isss', 'travel_risk', 'all'] },
             { id: 'pain_cost', text: 'Unpredictable costs and being "nickeled and dimed" for add-ons.', recommends: [], advantage: 'Terra Dotta offers comprehensive solutions with bundled services and features, providing transparent, predictable pricing. While other vendors may upsell for critical features like SSO or basic integrations, Terra Dotta includes them.', focus: ['study_abroad', 'isss', 'travel_risk', 'all'] },
             { id: 'pain_payments', text: 'A disconnected or manual payment collection process.', recommends: ['Payment Gateway'], advantage: 'Terra Dotta‚Äôs payment gateway integrations are more robust and seamless than others, offering fully integrated solutions that simplify processes for administrators and applicants by automating payment status updates.', focus: ['study_abroad', 'all'] },
             { id: 'pain_data', text: 'Inability to create custom reports or visualize data effectively.', recommends: ['Dashboards'], advantage: 'Terra Dotta‚Äôs advanced analytics and visualization tools offer customizable reporting without relying on external tools like Excel. It provides real-time insights in a centralized platform, empowering institutions to make data-driven decisions easily.', focus: ['study_abroad', 'isss', 'travel_risk', 'all'] },
             { id: 'pain_forms', text: 'Losing historical data when editing forms.', recommends: ['Study Abroad', 'ISSS'], advantage: 'Terra Dotta‚Äôs form management preserves historical data by versioning. When you edit a form, it creates a new version, ensuring you never lose past submission data‚Äîa significant advantage for data retention and quality of life.', focus: ['study_abroad', 'isss', 'all'] },
             { id: 'pain_site', text: 'No option for a public-facing, informational website.', recommends: ['Study Abroad'], advantage: 'Terra Dotta allows partners to have a public-facing website to inform stakeholders, becoming a key part of the recruitment and information-sharing process and eliminating a barrier for prospective students.', focus: ['study_abroad', 'all'] }
        ];

        const studyAbroadPainPoints = [
            { id: 'sa_pain_crises', text: 'Struggling to maintain real-time visibility into student whereabouts during international crises?', recommends: ['AlertTraveler¬Æ'], advantage: 'AlertTraveler provides a comprehensive safety solution with real-time alerts and location tracking, ensuring you can support your students effectively during emergencies.' },
            { id: 'sa_pain_bottlenecks', text: 'Struggling to identify application bottlenecks before they impact enrollment targets?', recommends: ['Engage'], advantage: 'Engage helps you manage the full student journey, from prospect to applicant, giving you the insights to identify and resolve bottlenecks early.' },
            { id: 'sa_pain_roi', text: 'Struggling to demonstrate the ROI and impact of your global education initiatives?', recommends: ['Dashboards'], advantage: 'Dashboards transform your program data into compelling visual reports, making it easy to demonstrate value and strategic impact to stakeholders.' },
            { id: 'sa_pain_pipeline', text: 'Finding it impossible to get real-time visibility into your study abroad pipeline?', recommends: ['Dashboards', 'Study Abroad'], advantage: 'Terra Dotta provides a unified platform to track your entire study abroad pipeline, from initial interest to post-decision, with powerful reporting to give you a clear, real-time view.'},
            { id: 'sa_pain_cost', text: 'Want to lower your cost for Study Abroad software?', recommends: [], advantage: 'Terra Dotta offers predictable, transparent pricing with bundled services, providing a comprehensive solution that avoids unexpected costs and delivers a lower total cost of ownership compared to many vendors.'}
        ];

        const isssPainPoints = [
            { id: 'isss_pain_sevis', text: 'Struggling to manage SEVIS compliance deadlines and avoid data errors?', recommends: ['ISSS'], advantage: 'Terra Dotta for ISSS provides robust validation and batching tools to ensure SEVIS compliance and reduce the risk of costly errors.'},
            { id: 'isss_pain_paperwork', text: 'Feeling overwhelmed by the volume of student and scholar paperwork?', recommends: ['ISSS'], advantage: 'Digitize your forms and workflows with Terra Dotta, automating tasks and providing a central hub for all student and scholar data, significantly reducing administrative burden.'},
            { id: 'isss_pain_reporting', text: 'Finding it difficult to track and report on your international populations effectively?', recommends: ['Dashboards'], advantage: 'Dashboards for ISSS allows you to visualize your data, track trends, and generate compelling reports on your international populations with ease.'},
            { id: 'isss_pain_disconnected', text: 'Is your current system disconnected from your study abroad or travel risk solutions?', recommends: ['Study Abroad', 'Travel Registry'], advantage: 'Terra Dotta\'s unified platform integrates ISSS, Study Abroad, and Travel Risk, providing a single source of truth and breaking down data silos across campus.'}
        ];

        const travelRiskPainPoints = [
            { id: 'tr_pain_duty', text: 'Concerned about fulfilling your institution\'s Duty of Care for all travelers?', recommends: ['AlertTraveler¬Æ', 'Travel Registry'], advantage: 'Terra Dotta provides a comprehensive duty of care suite, combining trip registration with real-time alerts and a mobile app to keep your travelers safe and informed.' },
            { id: 'tr_pain_locate', text: 'Finding it difficult to locate travelers quickly during an emergency?', recommends: ['AlertTraveler¬Æ'], advantage: 'With GPS check-ins and itinerary-based location tracking, AlertTraveler allows you to instantly locate and communicate with affected travelers during a crisis.' },
            { id: 'tr_pain_registration', text: 'Struggling to get travelers to register their trips in a timely manner?', recommends: ['Travel Registry'], advantage: 'Our Travel Registry streamlines the process with itinerary parsing and simple web forms, increasing compliance and ensuring you have a complete picture of institutional travel.' },
            { id: 'tr_pain_communication', text: 'Lacking a centralized system for all travel communication and alerts?', recommends: ['AlertTraveler¬Æ'], advantage: 'AlertTraveler serves as your central command for travel communications, allowing you to send targeted alerts and safety information to specific groups of travelers.' }
        ];
        
        const barriers = [ { id: 'barrier_cost', text: 'Overall cost and budget constraints.' }, { id: 'barrier_implementation', text: 'The time and effort required for implementation.' }, { id: 'barrier_buy_in', text: 'Getting internal buy-in from stakeholders and leadership.' }, { id: 'barrier_it', text: 'Limited IT department bandwidth and resources.' }, { id: 'barrier_training', text: 'Concerns about training users and ensuring adoption.' } ];
        const barrierResponses = { 'barrier_cost': { title: 'Regarding Cost & Budget', text: 'We understand budget is a primary concern. Terra Dotta\'s platform approach offers significant long-term ROI by consolidating systems, automating manual tasks to free up staff time, and mitigating costly compliance risks. We offer flexible pricing and can work with you to build a business case that demonstrates clear value to your leadership.' }, 'barrier_implementation': { title: 'Regarding Implementation', text: 'Our dedicated implementation team partners with you every step of the way. We use a proven methodology to ensure a smooth transition, from data migration to system configuration, minimizing disruption to your office and get you up and running efficiently.' }, 'barrier_buy_in': { title: 'Regarding Internal Buy-In', text: 'Getting everyone on board is key. Our solutions provide clear benefits for every role, from advisors to leadership. The Dashboards tool is specifically designed to help you demonstrate the impact and success of your global programs to stakeholders, making the case for investment clear and compelling.' }, 'barrier_it': { title: 'Regarding IT Bandwidth', text: 'We know IT resources are precious. As a cloud-hosted solution, Terra Dotta manages the infrastructure, security, and updates, significantly reducing the burden on your campus IT team. Our integrations are designed to work seamlessly with existing campus systems.' }, 'barrier_training': { title: 'Regarding Training & Adoption', text: 'User adoption is critical for success. We provide comprehensive training resources, including live sessions, on-demand videos, and detailed documentation. Our intuitive user interface is designed to be user-friendly, ensuring your team can leverage the full power of the platform quickly.' } };
        const valuePropositionByRole = { 'avp': 'AVPs can demonstrate measurable progress toward internationalization goals while ensuring institutional safety and compliance.', 'isss_director': 'Dramatically reduces administrative burden while ensuring 100% SEVIS compliance and enhancing the international student experience.', 'sa_director': 'Enables growth in study abroad participation while maintaining the highest safety standards and operational efficiency.', 'pdso_dso': 'Eliminates SEVIS compliance anxiety through automated workflows and fail-safes, protecting institutional certification while reducing administrative burden.', 'advisor': 'Empowers advisors to focus on high-value student interactions while automating routine tasks and ensuring compliance.', 'recruiter': 'Streamline recruitment campaigns, track prospect engagement, and measure conversion rates to boost international enrollment.', 'risk': 'Provides a comprehensive duty of care and liability management solution for all institutional travel, ensuring traveler safety and centralized oversight.', 'liaison': 'Empowers academic departments with tools for faculty-led program management and seamless support for international students and scholars.', 'other': 'Terra Dotta\'s comprehensive platform addresses core challenges across global education, from strategic leadership to day-to-day compliance.' };
        const usStates = ["Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"];
        const directorEmailsByState = { 'Alaska': 'jeralyn.woodall@terradotta.com', 'Alabama': 'laura.matrazzo@terradotta.com', 'Arkansas': 'jeralyn.woodall@terradotta.com', 'Arizona': 'chelsea.curtis@terradotta.com', 'California': 'chelsea.curtis@terradotta.com', 'Colorado': 'jeralyn.woodall@terradotta.com', 'Connecticut': 'george.hogan@terradotta.com', 'District of Columbia': 'laura.matrazzo@terradotta.com', 'Delaware': 'george.hogan@terradotta.com', 'Florida': 'laura.matrazzo@terradotta.com', 'Georgia': 'laura.matrazzo@terradotta.com', 'Hawaii': 'chelsea.curtis@terradotta.com', 'Iowa': 'frank.merendino@terradotta.com', 'Idaho': 'chelsea.curtis@terradotta.com', 'Illinois': 'frank.merendino@terradotta.com', 'Indiana': 'frank.merendino@terradotta.com', 'Kansas': 'jeralyn.woodall@terradotta.com', 'Kentucky': 'frank.merendino@terradotta.com', 'Louisiana': 'jeralyn.woodall@terradotta.com', 'Massachusetts': 'george.hogan@terradotta.com', 'Maryland': 'george.hogan@terradotta.com', 'Maine': 'george.hogan@terradotta.com', 'Michigan': 'frank.merendino@terradotta.com', 'Minnesota': 'frank.merendino@terradotta.com', 'Missouri': 'jeralyn.woodall@terradotta.com', 'Mississippi': 'laura.matrazzo@terradotta.com', 'Montana': 'chelsea.curtis@terradotta.com', 'North Carolina': 'laura.matrazzo@terradotta.com', 'North Dakota': 'jeralyn.woodall@terradotta.com', 'Nebraska': 'jeralyn.woodall@terradotta.com', 'New Hampshire': 'george.hogan@terradotta.com', 'New Jersey': 'george.hogan@terradotta.com', 'New Mexico': 'jeralyn.woodall@terradotta.com', 'Nevada': 'chelsea.curtis@terradotta.com', 'New York': 'george.hogan@terradotta.com', 'Ohio': 'frank.merendino@terradotta.com', 'Oklahoma': 'jeralyn.woodall@terradotta.com', 'Oregon': 'chelsea.curtis@terradotta.com', 'Pennsylvania': 'george.hogan@terradotta.com', 'Rhode Island': 'george.hogan@terradotta.com', 'South Carolina': 'laura.matrazzo@terradotta.com', 'South Dakota': 'jeralyn.woodall@terradotta.com', 'Tennessee': 'laura.matrazzo@terradotta.com', 'Texas': 'jeralyn.woodall@terradotta.com', 'Utah': 'chelsea.curtis@terradotta.com', 'Virginia': 'laura.matrazzo@terradotta.com', 'Vermont': 'george.hogan@terradotta.com', 'Washington': 'chelsea.curtis@terradotta.com', 'Wisconsin': 'frank.merendino@terradotta.com', 'West Virginia': 'laura.matrazzo@terradotta.com', 'Wyoming': 'chelsea.curtis@terradotta.com' };
        
        // --- DOM ELEMENTS ---
        const locationError = document.getElementById('location-error');
        const stateDropdownContainer = document.getElementById('state-dropdown-container');
        const stateDropdown = document.getElementById('state-dropdown');
        const rolesContainer = document.getElementById('roles');
        const roleError = document.getElementById('role-error');
        const currentSolutionsContainer = document.getElementById('currentSolutions');
        const challengesContainer = document.getElementById('challenges');
        const barriersContainer = document.getElementById('barriers');
        const currentResultsContainer = document.getElementById('currentResults');
        const recommendedResultsContainer = document.getElementById('recommendedResults');
        const benefitsContainer = document.getElementById('benefits');
        const valuePropositionText = document.getElementById('value-proposition-text');
        const barrierResponsesContainer = document.getElementById('barrier-responses-container');
        const barrierResponsesContent = document.getElementById('barrier-responses');
        const advantageContainer = document.getElementById('advantage-container');
        const advantageResponsesContent = document.getElementById('advantage-responses');
        const confirmationModal = document.getElementById('confirmation-modal');
        const connectDirectorBtn = document.getElementById('connect-director-btn');
        const notificationContainer = document.getElementById('notification-container');
        const progressSteps = document.querySelectorAll('.progress-step');
        const noSolutionsBtn = document.getElementById('no-solutions-btn');
        const competitorBtn = document.getElementById('competitor-btn');
        const challengesPrompt = document.getElementById('challenges-prompt');
        const competitorFocusStep = document.getElementById('step-competitor-focus');
        const competitorFocusError = document.getElementById('competitor-focus-error');
        const saPainsStep = document.getElementById('step-sa-pains');
        const saPainsContainer = document.getElementById('sa-pains-container');
        const isssPainsStep = document.getElementById('step-isss-pains');
        const isssPainsContainer = document.getElementById('isss-pains-container');
        const trPainsStep = document.getElementById('step-tr-pains');
        const trPainsContainer = document.getElementById('tr-pains-container');

        let currentStep = 1;
        let selectedDirectorEmail = null;
        let sessionData = {};
        let isNewUserPath = false;
        let isCompetitorUserPath = false;
        let isInternationalUser = false;
        let painPointPath = null; // Can be 'sap', 'issp', 'trp', or null

        // --- NOTIFICATION SYSTEM ---
        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.createElement('div');
            notification.className = `notification max-w-sm bg-white border-l-4 p-4 rounded-lg shadow-lg flex items-start pointer-events-auto ${
                type === 'success' ? 'border-td-green' : 
                type === 'error' ? 'border-red-500' : 
                type === 'info' ? 'border-td-blue' : 'border-td-orange'
            }`;
            
            const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : type === 'info' ? '‚Ñπ' : '‚ö†';
            const color = type === 'success' ? 'text-td-green' : 
                          type === 'error' ? 'text-red-500' : 
                          type === 'info' ? 'text-td-blue' : 'text-td-orange';
            
            notification.innerHTML = `
                <div class="flex-shrink-0 ${color} font-bold text-lg mr-3">${icon}</div>
                <div class="flex-1">
                    <p class="text-sm font-medium text-slate-800">${message}</p>
                </div>
                <button class="ml-2 text-slate-400 hover:text-slate-600" onclick="this.parentElement.remove()">√ó</button>
            `;
            
            notificationContainer.appendChild(notification);
            
            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.classList.add('removing');
                        setTimeout(() => notification.remove(), 300);
                    }
                }, duration);
            }
        }
        
        // --- PROGRESS TRACKING ---
        function updateProgress(step) {
            progressSteps.forEach((stepEl, index) => {
                const isCompleted = index + 1 < step;
                const isCurrent = index + 1 === step;
                
                stepEl.className = `progress-step w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300 border-2 ${
                    isCompleted ? 'bg-td-green border-td-green text-white' : 
                    isCurrent ? 'bg-td-blue border-td-blue text-white scale-110 shadow-glow' : 
                    'bg-white border-slate-200 text-slate-300'
                }`;
                
                // Update labels
                const label = stepEl.nextElementSibling;
                if(label) {
                    label.className = `text-xs font-medium mt-2 hidden sm:block transition-colors duration-300 ${
                        isCompleted || isCurrent ? 'text-slate-700' : 'text-slate-300'
                    }`;
                }
            });
            trackSelection('currentStep', step);
        }
        
        function trackSelection(key, value) {
            sessionData.selections[key] = value;
        }

        function trackCheckboxSelection(name, value, isChecked) {
            if (!sessionData.selections[name]) {
                sessionData.selections[name] = [];
            }
            if (isChecked) {
                if (!sessionData.selections[name].includes(value)) {
                    sessionData.selections[name].push(value);
                }
            } else {
                sessionData.selections[name] = sessionData.selections[name].filter(v => v !== value);
            }
        }
        
        // --- UTILITY FUNCTIONS ---
        function createRadio(id, name, value, labelText) {
            const div = document.createElement('div');
            div.className = 'relative p-4 border border-slate-200 rounded-xl hover:border-td-blue hover:bg-blue-50/30 transition-colors cursor-pointer group';
            div.innerHTML = `
                <div class="flex items-start">
                    <input id="${id}" name="${name}" type="radio" value="${value}" class="custom-radio flex-shrink-0 mt-1">
                    <label for="${id}" class="ml-4 text-lg text-slate-700 font-medium w-full h-full block cursor-pointer">${labelText}</label>
                </div>`;
            const input = div.querySelector('input');
            input.addEventListener('change', () => trackSelection(name, value));
            div.addEventListener('click', (e) => {
                if(e.target !== input && e.target.tagName !== 'LABEL') input.click();
            });
            return div;
        }
        
        function createCheckbox(id, name, value, labelText) {
            const div = document.createElement('div');
            div.className = 'relative p-4 border border-slate-200 rounded-xl hover:border-td-blue hover:bg-blue-50/30 transition-colors cursor-pointer group';
            div.innerHTML = `
                <div class="flex items-start">
                    <input id="${id}" name="${name}" type="checkbox" value="${value}" class="custom-checkbox flex-shrink-0 mt-1">
                    <label for="${id}" class="ml-4 text-md text-slate-700 font-medium w-full h-full block cursor-pointer">${labelText}</label>
                </div>`;
            const input = div.querySelector('input');
            input.addEventListener('change', (event) => trackCheckboxSelection(name, value, event.target.checked));
            div.addEventListener('click', (e) => {
                if(e.target !== input && e.target.tagName !== 'LABEL') input.click();
            });
            return div;
        }
        
        function createSolutionCard(key, isFaded = false) { 
            const solution = solutions[key]; 
            if (!solution) return ''; 
            const opacityClass = isFaded ? 'opacity-60 grayscale' : ''; 
            const cardContent = `
                <div class="flex items-start">
                    <div class="flex-shrink-0 bg-slate-50 ${solution.color} rounded-lg p-3 border border-slate-100">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">${solution.icon}</svg>
                    </div>
                    <div class="ml-4">
                        <h4 class="font-bold text-lg text-slate-800 leading-tight">${key}</h4>
                        <p class="text-xs uppercase tracking-wider text-slate-400 font-semibold mt-1 mb-2">${solution.categoryTitle || 'Solution'}</p>
                        <p class="text-slate-600 text-sm leading-relaxed">${solution.description}</p>
                    </div>
                </div>`; 
            
            const wrapperClass = `bg-white p-6 rounded-xl border border-slate-200 flex flex-col h-full ${isFaded ? '' : 'card-hover shadow-sm'} ${opacityClass}`;
            
            return isFaded || !solution.url ? 
                `<div class="${wrapperClass}">${cardContent}</div>` : 
                `<a href="${solution.url}" target="_blank" class="block no-underline text-current group"><div class="${wrapperClass} group-hover:border-td-blue transition-colors">${cardContent}</div></a>`; 
        }

        // --- INITIALIZATION ---
        function initializeTool() {
            rolesContainer.innerHTML = '';
            currentSolutionsContainer.innerHTML = '';
            stateDropdown.innerHTML = '<option value="">Select your state...</option>';

            Object.keys(roles).forEach(key => { 
                rolesContainer.appendChild(createRadio(`role_${key}`, 'role', key, roles[key])); 
            });
            Object.keys(solutions).forEach(key => { 
                currentSolutionsContainer.appendChild(createCheckbox(`current_${key.replace(/[^a-zA-Z0-9]/g, '')}`, 'currentSolutions', key, key)); 
            });
            usStates.forEach(state => { stateDropdown.innerHTML += `<option value="${state}">${state}</option>`; });
            
            sessionData = {
                sessionId: 'session' + Date.now(),
                startTime: new Date().toISOString(),
                selections: {},
                completed: false
            };
            isNewUserPath = false;
            isCompetitorUserPath = false;
            isInternationalUser = false;
            painPointPath = null;
            updateProgress(1);
        }
        
        function hideAllSteps() {
            document.querySelectorAll('.wizard-step').forEach(s => s.classList.add('hidden'));
        }

        function goToStep(stepNumber) { 
            // Fade out current
            const currentVisible = document.querySelector('.wizard-step:not(.hidden)');
            if(currentVisible) {
                currentVisible.style.opacity = '0';
                currentVisible.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    hideAllSteps();
                    showNewStep(stepNumber);
                }, 300);
            } else {
                showNewStep(stepNumber);
            }
        }

        function showNewStep(stepNumber) {
            const nextStep = document.getElementById(`step${stepNumber}`);
            nextStep.classList.remove('hidden');
            // Small delay to allow display:block to apply before opacity transition
            setTimeout(() => {
                nextStep.style.opacity = '1';
                nextStep.style.transform = 'translateY(0)';
            }, 50);
            
            currentStep = stepNumber; 
            updateProgress(stepNumber);
            
            // Scroll to top of wizard
            const wizardTop = document.getElementById('progress-indicator').offsetTop - 100;
            window.scrollTo({ top: wizardTop, behavior: 'smooth' });
        }

        // Special handling for non-numbered steps
        function goToNamedStep(elementId) {
             const currentVisible = document.querySelector('.wizard-step:not(.hidden)');
            if(currentVisible) {
                currentVisible.style.opacity = '0';
                currentVisible.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    hideAllSteps();
                    const nextStep = document.getElementById(elementId);
                    nextStep.classList.remove('hidden');
                    setTimeout(() => {
                        nextStep.style.opacity = '1';
                        nextStep.style.transform = 'translateY(0)';
                    }, 50);
                     // Scroll to top
                    const wizardTop = document.getElementById('progress-indicator').offsetTop - 100;
                    window.scrollTo({ top: wizardTop, behavior: 'smooth' });
                }, 300);
            }
        }


        // --- UI INTERACTION LISTENERS ---
        document.querySelectorAll('input[name="location"]').forEach(radio => {
            radio.addEventListener('change', (event) => {
                isInternationalUser = event.target.value === 'intl';
                if (event.target.value === 'us') {
                    stateDropdownContainer.classList.remove('hidden');
                } else {
                    stateDropdownContainer.classList.add('hidden');
                    stateDropdown.value = '';
                    selectedDirectorEmail = 'daisy.gould@terradotta.com';
                    trackSelection('location', 'intl');
                }
                locationError.classList.add('hidden');
            });
        });

        noSolutionsBtn.addEventListener('click', () => {
            isNewUserPath = true;
            isCompetitorUserPath = false;
            painPointPath = null;
            document.querySelectorAll('input[name="currentSolutions"]').forEach(cb => {
                cb.checked = false;
                trackCheckboxSelection('currentSolutions', cb.value, false);
            });
            populateChallenges();
            goToStep(4);
        });

        competitorBtn.addEventListener('click', () => {
            isNewUserPath = false;
            isCompetitorUserPath = true;
            painPointPath = null;
            trackSelection('userPath', 'competitor');
            document.querySelectorAll('input[name="currentSolutions"]').forEach(cb => {
                cb.checked = false;
                cb.dispatchEvent(new Event('change')); 
            });
            goToNamedStep('step-competitor-focus');
        });
        
        // --- NAVIGATION BUTTON LISTENERS ---
        document.getElementById('next-btn-1').addEventListener('click', () => {
            const location = document.querySelector('input[name="location"]:checked');
            if (!location) {
                locationError.classList.remove('hidden'); 
                showNotification('Please select your location first', 'error');
                return; 
            }
            if(location.value === 'us'){
                if (!stateDropdown.value){
                    locationError.textContent = "Please select your state to continue.";
                    locationError.classList.remove('hidden'); 
                    showNotification('Please select your state', 'error');
                    return;
                }
                selectedDirectorEmail = directorEmailsByState[stateDropdown.value] || null;
                trackSelection('location', 'us');
                trackSelection('state', stateDropdown.value);
            }
            locationError.classList.add('hidden');
            setupStep2();
            goToStep(2);
        });

        document.getElementById('back-btn-2').addEventListener('click', () => goToStep(1));
        document.getElementById('next-btn-2').addEventListener('click', () => {
            const roleSelected = document.querySelector('input[name="role"]:checked');
            if (!roleSelected) { 
                roleError.classList.remove('hidden'); 
                showNotification('Please select your role first', 'error');
                return; 
            }
            roleError.classList.add('hidden');
            setupStep3();
            goToStep(3);
        });

        document.getElementById('back-btn-3').addEventListener('click', () => goToStep(2));
        document.getElementById('next-btn-3').addEventListener('click', () => {
            isNewUserPath = false;
            isCompetitorUserPath = false;
            painPointPath = null;
            populateChallenges(); 
            goToStep(4);
        });
        
        document.getElementById('back-btn-cf').addEventListener('click', () => {
            goToStep(3);
            isCompetitorUserPath = false;
        });

        document.getElementById('next-btn-cf').addEventListener('click', () => {
            const focusSelected = document.querySelector('input[name="competitor_focus"]:checked');
            if (!focusSelected) {
                competitorFocusError.classList.remove('hidden');
                showNotification('Please select a focus area to continue.', 'error');
                return;
            }
            competitorFocusError.classList.add('hidden');
            trackSelection('competitor_focus', focusSelected.value);

            if (focusSelected.value === 'study_abroad') {
                painPointPath = 'sap';
                populateSAPains();
                goToNamedStep('step-sa-pains');
            } else if (focusSelected.value === 'isss') {
                painPointPath = 'issp';
                populateISSSPains();
                goToNamedStep('step-isss-pains');
            } else if (focusSelected.value === 'travel_risk') {
                painPointPath = 'trp';
                populateTRPains();
                goToNamedStep('step-tr-pains');
            } else if (focusSelected.value === 'all') {
                painPointPath = 'all';
                populateBarriers();
                goToStep(5);
            }
        });

        // Pain Point Step Navigation
        document.getElementById('back-btn-sap').addEventListener('click', () => goToNamedStep('step-competitor-focus'));
        document.getElementById('next-btn-sap').addEventListener('click', () => { populateBarriers(); goToStep(5); });
        
        document.getElementById('back-btn-issp').addEventListener('click', () => goToNamedStep('step-competitor-focus'));
        document.getElementById('next-btn-issp').addEventListener('click', () => { populateBarriers(); goToStep(5); });

        document.getElementById('back-btn-trp').addEventListener('click', () => goToNamedStep('step-competitor-focus'));
        document.getElementById('next-btn-trp').addEventListener('click', () => { populateBarriers(); goToStep(5); });


        document.getElementById('back-btn-4').addEventListener('click', () => {
             // This step is now only for non-competitor paths
            goToStep(3);
        });

        document.getElementById('next-btn-4').addEventListener('click', () => {
            painPointPath = null;
            populateBarriers();
            goToStep(5);
        });
        
        document.getElementById('back-btn-5').addEventListener('click', () => {
            if (painPointPath === 'sap') {
                goToNamedStep('step-sa-pains');
            } else if (painPointPath === 'issp') {
                goToNamedStep('step-isss-pains');
            } else if (painPointPath === 'trp') {
                goToNamedStep('step-tr-pains');
            } else if (painPointPath === 'all') {
                 goToNamedStep('step-competitor-focus');
            }
            else {
                goToStep(4);
            }
        });
        
        document.getElementById('results-btn').addEventListener('click', showResults);
        
        function setupStep2() {
            const rolesToHide = ['isss_director', 'pdso_dso', 'advisor'];
            rolesToHide.forEach(roleKey => {
                const roleInput = document.querySelector(`input[value="${roleKey}"]`);
                if (roleInput) {
                    roleInput.parentElement.parentElement.style.display = isInternationalUser ? 'none' : 'block';
                }
            });
        }
        
        function setupStep3() {
            const isssSolutionCheckbox = document.querySelector('input[value="ISSS"]');
            if(isssSolutionCheckbox){
                 isssSolutionCheckbox.parentElement.parentElement.style.display = isInternationalUser ? 'none' : 'block';
            }
        }

        function populateSAPains() {
            saPainsContainer.innerHTML = '';
            studyAbroadPainPoints.forEach(point => {
                saPainsContainer.appendChild(createCheckbox(point.id, 'challenges', point.id, point.text));
            });
        }

        function populateISSSPains() {
            isssPainsContainer.innerHTML = '';
            isssPainPoints.forEach(point => {
                isssPainsContainer.appendChild(createCheckbox(point.id, 'challenges', point.id, point.text));
            });
        }

        function populateTRPains() {
            trPainsContainer.innerHTML = '';
            travelRiskPainPoints.forEach(point => {
                trPainsContainer.appendChild(createCheckbox(point.id, 'challenges', point.id, point.text));
            });
        }

        function populateChallenges() {
            challengesContainer.innerHTML = '';
            const selectedRole = document.querySelector('input[name="role"]:checked')?.value || 'other';
            const step4Title = document.querySelector('#step4 h2');
            
            challengesContainer.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';
            step4Title.textContent = 'Your Challenges';

            const useAVPPath = (isNewUserPath || isCompetitorUserPath) && selectedRole === 'avp';
            
            if (useAVPPath) {
                 step4Title.textContent = 'Your Challenges';
                 challengesPrompt.innerHTML = "As a leader, your challenges are unique. Select the areas where you're facing the most pressure.";
                 challengesContainer.className = 'space-y-4';
                 const avpFocusOrder = ['focus_avp_data', 'focus_avp_roi', 'focus_avp_risk', 'focus_avp_reputation', 'focus_avp_efficiency'];
                 const focusAreas = focusAreasByRole.avp.slice().sort((a,b) => avpFocusOrder.indexOf(a.id) - avpFocusOrder.indexOf(b.id));
                 focusAreas.forEach(area => {
                     if (!isInternationalUser || !area.recommends.includes('ISSS')){
                         challengesContainer.appendChild(createCheckbox(area.id, 'challenges', area.id, area.text));
                     }
                 });

            } else if (isNewUserPath) {
                step4Title.textContent = 'Your Focus Areas';
                challengesPrompt.innerHTML = "What are your primary objectives? <br/> <span class='text-sm text-slate-400'>Select one or more areas to see how Terra Dotta can help.</span>";
                let focusAreas = focusAreasByRole[selectedRole] || focusAreasByRole['default'];
                if (isInternationalUser) {
                    focusAreas = focusAreas.filter(area => !area.recommends.includes('ISSS'));
                }
                focusAreas.forEach(area => {
                    challengesContainer.appendChild(createCheckbox(area.id, 'challenges', area.id, area.text));
                });
            } else if (isCompetitorUserPath) {
                 challengesPrompt.innerHTML = "You mentioned using another vendor. What are your primary pain points? <br/> <span class='text-sm text-slate-400'>Select the challenges that resonate most with your experience.</span>";
                 const selectedFocus = sessionData.selections['competitor_focus'];
                 let painPoints = competitorPainPoints;
                 if (selectedFocus && selectedFocus !== 'all') {
                     painPoints = competitorPainPoints.filter(p => p.focus.includes(selectedFocus));
                 }
                 if (isInternationalUser) {
                     painPoints = painPoints.filter(p => !p.recommends.includes('ISSS'));
                 }
                 painPoints.forEach(point => {
                     challengesContainer.appendChild(createCheckbox(point.id, 'challenges', point.id, point.text));
                 });
            } else {
                challengesPrompt.textContent = "Based on your role, what are your biggest challenges right now? Select all that apply.";
                let challengesForRole = challengesByRole[selectedRole];
                
                if (isInternationalUser) {
                    challengesForRole = challengesForRole.filter(c => !c.recommends.includes('ISSS'));
                }
            
                challengesForRole.forEach(challenge => { 
                    challengesContainer.appendChild(createCheckbox(challenge.id, 'challenges', challenge.id, challenge.text)); 
                });
            
                const ownedSolutions = Array.from(document.querySelectorAll('input[name="currentSolutions"]:checked')).map(cb => cb.value);
                const challengesToHide = new Set();
                challengesForRole.forEach(challenge => {
                    const challengeIsSolved = challenge.recommends.every(rec => ownedSolutions.includes(rec));
                    if (challengeIsSolved) { challengesToHide.add(challenge.id); }
                });
                challengesForRole.forEach(challenge => {
                    const challengeElement = document.getElementById(challenge.id)?.parentElement.parentElement;
                    if (challengeElement) { challengeElement.style.display = challengesToHide.has(challenge.id) ? 'none' : 'block'; }
                });
            }
        }
        
        function populateBarriers() { 
            barriersContainer.innerHTML = ''; 
            barriers.forEach(barrier => { 
                barriersContainer.appendChild(createCheckbox(barrier.id, 'barriers', barrier.id, barrier.text)); 
            }); 
        }
        
        function showResults() {
            if (selectedDirectorEmail) {
                connectDirectorBtn.classList.remove('hidden');
            } else {
                connectDirectorBtn.classList.add('hidden');
            }

            const ownedSolutions = Array.from(document.querySelectorAll('input[name="currentSolutions"]:checked')).map(cb => cb.value);
            const selectedChallengeIds = Array.from(document.querySelectorAll('input[name="challenges"]:checked')).map(cb => cb.value);
            const selectedBarrierIds = Array.from(document.querySelectorAll('input[name="barriers"]:checked')).map(cb => cb.value);
            const selectedRole = document.querySelector('input[name="role"]:checked')?.value || 'other';
            
            const allPossibleChallenges = [...Object.values(challengesByRole).flat(), ...Object.values(focusAreasByRole).flat(), ...competitorPainPoints, ...studyAbroadPainPoints, ...isssPainPoints, ...travelRiskPainPoints];

            let recommendations = new Set();
            let advantageText = '';

            // Add base recommendations from competitor focus selection
            if (isCompetitorUserPath) {
                const focus = sessionData.selections['competitor_focus'];
                if (focus === 'study_abroad') {
                    recommendations.add('Study Abroad');
                } else if (focus === 'isss') {
                    recommendations.add('ISSS');
                } else if (focus === 'travel_risk') {
                    recommendations.add('AlertTraveler¬Æ');
                    recommendations.add('Travel Registry');
                } else if (focus === 'all') {
                    recommendations.add('Study Abroad');
                    recommendations.add('ISSS');
                    recommendations.add('Travel Registry');
                    recommendations.add('AlertTraveler¬Æ');
                    recommendations.add('Dashboards');
                    recommendations.add('Agreements Management');
                }
            }
            
            // Add recommendations from selected challenges/pain points
            selectedChallengeIds.forEach(challengeId => { 
                const challenge = allPossibleChallenges.find(p => p.id === challengeId); 
                if (challenge) { 
                    challenge.recommends.forEach(rec => recommendations.add(rec)); 
                    if (challenge.advantage) {
                        advantageText += `<div class="p-5 bg-blue-50/50 border border-blue-100 rounded-xl"><h4 class="font-semibold text-slate-800 mb-2 flex items-center"><span class="text-td-blue mr-2">‚òÖ</span>${challenge.text}</h4><p class="text-slate-600 text-sm leading-relaxed">${challenge.advantage}</p></div>`;
                    }
                } 
            });

            if(isCompetitorUserPath && advantageText){
                advantageContainer.classList.remove('hidden');
                advantageResponsesContent.innerHTML = advantageText;
            } else {
                advantageContainer.classList.add('hidden');
            }

            const finalRecommendations = [...recommendations].filter(rec => !ownedSolutions.includes(rec));
            
            barrierResponsesContent.innerHTML = '';
            if (selectedBarrierIds.length > 0) {
                barrierResponsesContainer.classList.remove('hidden');
                selectedBarrierIds.forEach(barrierId => { 
                    const response = barrierResponses[barrierId]; 
                    if (response) { 
                        barrierResponsesContent.innerHTML += `<div class="p-5 bg-slate-50 border border-slate-100 rounded-xl"><h4 class="font-semibold text-slate-800 mb-2">${response.title}</h4><p class="text-slate-600 text-sm leading-relaxed">${response.text}</p></div>`; 
                    } 
                });
            } else { 
                barrierResponsesContainer.classList.add('hidden'); 
            }

            currentResultsContainer.innerHTML = ownedSolutions.length > 0 ? ownedSolutions.map(key => createSolutionCard(key, true)).join('') : `<div class="text-center p-8 border-2 border-dashed border-slate-200 rounded-xl"><p class="text-slate-400">You didn't select any current solutions.</p></div>`;
            
            if (finalRecommendations.length > 0) {
                recommendedResultsContainer.innerHTML = finalRecommendations.map(key => createSolutionCard(key)).join('');
            } else if (selectedChallengeIds.length > 0) {
                recommendedResultsContainer.innerHTML = `<div class="text-center p-8 border-2 border-dashed border-td-green rounded-xl bg-green-50/30"><h4 class="font-bold text-td-green mb-2 text-lg">You're Covered!</h4><p class="text-slate-600">Based on the challenges you selected, your current solutions have you covered.</p></div>`;
            } else {
                recommendedResultsContainer.innerHTML = `<div class="text-center p-8 border-2 border-dashed border-slate-200 rounded-xl"><p class="text-slate-400">Select a challenge to see recommendations.</p></div>`;
            }

            valuePropositionText.textContent = valuePropositionByRole[selectedRole];
            const allBenefits = new Set();
            const allSolutionsList = [...ownedSolutions, ...finalRecommendations];
            allSolutionsList.forEach(key => { 
                if(solutions[key] && solutions[key].solves) { 
                    allBenefits.add(solutions[key].solves); 
                } 
            });
            benefitsContainer.innerHTML = allBenefits.size > 0 ? [...allBenefits].map(benefit => `<li>${benefit}</li>`).join('') : `<p class="text-slate-400 text-center col-span-full italic">Your benefits will appear here once you select solutions and challenges.</p>`;
            
            sessionData.completed = true;
            sessionData.completedTime = new Date().toISOString();
            sessionData.finalRecommendations = finalRecommendations;
            sessionData.ownedSolutions = ownedSolutions;
            
            showNotification('Recommendations generated! üéâ', 'success');
            goToStep(6);
        }
        
        function resetFinder() {
            document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(cb => cb.checked = false);
            locationError.classList.add('hidden');
            roleError.classList.add('hidden');
            stateDropdownContainer.classList.add('hidden');
            stateDropdown.value = '';
            barrierResponsesContainer.classList.add('hidden');
            advantageContainer.classList.add('hidden');
            connectDirectorBtn.classList.add('hidden');
            showNotification('Tool reset successfully', 'info');
            
            initializeTool();
            goToStep(1);
        }
        
        function getResultsForEmail() {
            const ownedSolutions = sessionData.ownedSolutions || [];
            const finalRecommendations = sessionData.finalRecommendations || [];
            const selectedRoleKey = sessionData.selections.role || 'other';

            let body = `Your Key Challenge\r\n`;
            body += `${valuePropositionByRole[selectedRoleKey]}\r\n\r\n`;

            if (ownedSolutions.length > 0) {
                body += 'Core Solution Already in Place\r\n';
                ownedSolutions.forEach(key => {
                    const solution = solutions[key];
                    body += `${solution.name} - ${solution.description}\r\n\r\n`;
                });
            }
            
            if (finalRecommendations.length > 0) {
                body += 'Recommended Strategic Additions\r\n\r\n';
                const categorizedRecs = {};
                finalRecommendations.forEach(key => {
                    const category = solutions[key].category;
                    if (!categorizedRecs[category]) {
                        categorizedRecs[category] = [];
                    }
                    categorizedRecs[category].push(key);
                });
                for (const category in categorizedRecs) {
                    body += `${solutions[categorizedRecs[category][0]].categoryTitle}\r\n`;
                    categorizedRecs[category].forEach(key => {
                        const solution = solutions[key];
                        body += `${solution.name} - ${solution.description}\r\n`;
                    });
                    body += '\r\n';
                }
            }
            return { body, subject: `Terra Dotta Solution Finder Results` };
        }

        // --- FINAL ACTION BUTTON LISTENERS ---
        document.getElementById('reset-btn').addEventListener('click', () => {
            confirmationModal.classList.remove('hidden');
        });
        
        document.getElementById('confirm-reset-btn').addEventListener('click', () => {
            resetFinder();
            confirmationModal.classList.add('hidden');
        });
        
        document.getElementById('cancel-reset-btn').addEventListener('click', () => {
            confirmationModal.classList.add('hidden');
        });

        document.getElementById('print-btn').addEventListener('click', () => {
            showNotification('Preparing document for printing...', 'info', 1000);
            setTimeout(() => window.print(), 500);
        });
        
        document.getElementById('email-btn').addEventListener('click', () => { 
            const { subject, body } = getResultsForEmail(); 
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`; 
            showNotification('Opening email client...', 'info');
        });
        
        connectDirectorBtn.addEventListener('click', () => {
            if (!selectedDirectorEmail) return;
            const { subject, body } = getResultsForEmail();
            window.location.href = `mailto:${selectedDirectorEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            showNotification('Connecting you with your local director', 'info');
        });
                
        document.getElementById('back-btn-6').addEventListener('click', () => goToStep(5));

        // --- KICK IT OFF ---
        initializeTool();

    });
    </script>
</body>
</html>
